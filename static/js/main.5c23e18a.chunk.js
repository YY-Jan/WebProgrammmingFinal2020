(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{154:function(e,t,i){},159:function(e,t,i){},194:function(e,t,i){},195:function(e,t,i){"use strict";i.r(t);i(154);var a=i(0),o=i.n(a),s=i(15),n=i.n(s),r=(i(159),function(e){e&&e instanceof Function&&i.e(3).then(i.bind(null,295)).then((function(t){var i=t.getCLS,a=t.getFID,o=t.getFCP,s=t.getLCP,n=t.getTTFB;i(e),a(e),o(e),s(e),n(e)}))}),l=i(14),c=i.n(l),h=i(20),d=i(8),p=i(13),y=i(21),u=i(114),b=i.n(u).a.create({baseURL:"https://p4000.140-112-18-200.nip.io/"}),f=i(257),v=i(287),g=i(250),m=i(201),k=i(258),j=i(259),x=i(286),w=i(284),P=i(2);function O(e){return Object(P.jsx)(w.a,Object(p.a)({elevation:6,variant:"filled"},e))}var S=Object(g.a)({input:{margin:"0 0.2em"},button:{width:"100px",marginLeft:"0.6em"}}),T=function(){var e=Object(y.f)(),t=S(),i=Object(a.useState)(""),o=Object(d.a)(i,2),s=o[0],n=o[1],r=Object(a.useState)(""),l=Object(d.a)(r,2),p=l[0],u=l[1],g=Object(a.useState)(""),w=Object(d.a)(g,2),T=w[0],F=w[1],C=Object(a.useState)(""),D=Object(d.a)(C,2),M=D[0],A=D[1],R=Object(a.useState)(""),I=Object(d.a)(R,2),L=I[0],E=I[1],z=Object(a.useState)(!1),B=Object(d.a)(z,2),G=B[0],N=B[1],W=Object(a.useState)(!1),q=Object(d.a)(W,2),Y=q[0],X=q[1],_=Object(a.useState)(!1),U=Object(d.a)(_,2),H=U[0],V=U[1],K=Object(a.useState)(""),Q=Object(d.a)(K,2),J=Q[0],Z=Q[1],$=Object(a.useState)("success"),ee=Object(d.a)($,2),te=ee[0],ie=ee[1],ae=function(e){return function(t){e(t.target.value.trim())}},oe=function(){var t=Object(h.a)(c.a.mark((function t(){var i,a,o,n,r;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,b.post("/api/login",{name:s,pwd:p});case 2:i=t.sent,a=i.data,o=a.success,n=a.uuid,r=a.mapIDs,o?e.push({pathname:"/users/selectPage",search:"",state:{uuid:n,name:s,login:!0,mapIDs:r}}):(Z("Wrong password or the user doesn't exist."),ie("error"),V(!0));case 8:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),se=function(){var e=Object(h.a)(c.a.mark((function e(){var t,i,a,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.post("/api/signup",{name_:T,pwd_:M});case 2:t=e.sent,i=t.data,a=i.success,o=i.msg,a?(Z("This is a success message!"),ie("success"),V(!0)):(Z(o),ie("error"),V(!0)),N(!1);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ne=function(){var e=Object(h.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.post("/api/clear",{});case 2:t=e.sent,t.data.success?(Z("This is a success message!"),ie("success"),V(!0)):(Z("Delete Fail"),ie("error"),V(!0));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),re=function(){var e=Object(h.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.post("/api/deleteMap",{});case 2:t=e.sent,t.data.success?(Z("This is a success message!"),ie("success"),V(!0)):(Z("Delete Fail"),ie("error"),V(!0));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(P.jsxs)("section",{className:"Wrapper",children:[Object(P.jsx)(x.a,{open:H,autoHideDuration:3e3,onClose:function(){V(!1)},children:Object(P.jsx)(O,{onClose:function(){V(!1)},severity:te,children:J})}),Object(P.jsxs)("div",{className:"Row",children:[Object(P.jsx)(v.a,{className:t.input,placeholder:"Name",value:s,onChange:ae(n)}),Object(P.jsx)(v.a,{className:t.input,placeholder:"Password",style:{width:240},value:p,type:Y?"text":"password",onChange:ae(u)}),Object(P.jsx)(f.a,{className:t.button,variant:"contained",color:"primary",disabled:!s||!p,onClick:oe,children:"\u767b\u5165"}),Object(P.jsx)(f.a,{className:t.button,variant:"outlined",color:"secondary",onClick:function(){N(!0)},children:"\u8a3b\u518a"})]}),Object(P.jsx)("div",{className:"Row1",children:Object(P.jsx)(k.a,{control:Object(P.jsx)(j.a,{checked:Y,onChange:function(){return X(!Y)},name:"planttext password"}),label:"\u986f\u793a\u5bc6\u78bc"})}),Object(P.jsx)(m.a,{open:G,onClose:function(){N(!1)},children:Object(P.jsxs)("div",{className:"SignUP",children:[Object(P.jsx)(v.a,{className:t.input,placeholder:"Name",value:T,onChange:ae(F)}),Object(P.jsx)(v.a,{className:t.input,placeholder:"Password",style:{width:240},value:M,type:Y?"text":"password",onChange:ae(A)}),Object(P.jsx)(v.a,{className:t.input,placeholder:"Retype Your Password",style:{width:240},value:L,type:Y?"text":"password",onChange:ae(E)}),Object(P.jsx)(f.a,{className:t.button,variant:"contained",color:"secondary",disabled:!T||!M||M!==L,onClick:se,children:"\u8a3b\u518a"}),Object(P.jsx)("div",{className:"Row1",children:Object(P.jsx)(k.a,{control:Object(P.jsx)(j.a,{checked:Y,onChange:function(){return X(!Y)},name:"planttext password"}),label:"\u986f\u793a\u5bc6\u78bc"})})]})}),Object(P.jsxs)("div",{style:"admin"===s&&"deletemode"===p?{display:"block"}:{display:"none"},children:[Object(P.jsx)(f.a,{className:t.button,variant:"outlined",color:"secondary",disabled:!1,onClick:ne,children:"Delete User"}),Object(P.jsx)(f.a,{className:t.button,variant:"outlined",color:"secondary",disabled:!1,onClick:re,children:"Delete Map"})]})]})},F=i(46),C=i(16),D=i(17),M=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Object(C.a)(this,e),this.x=t,this.y=i}return Object(D.a)(e,[{key:"init",value:function(){this.x=0,this.y=0}},{key:"set",value:function(e,t){this.x=e,this.y=t}},{key:"clone",value:function(){return new e(this.x,this.y)}},{key:"equal",value:function(e){return this.x===e.x&&this.y===e.y}},{key:"add",value:function(t){return new e(this.x+t.x,this.y+t.y)}},{key:"sub",value:function(t){return new e(this.x-t.x,this.y-t.y)}},{key:"mul",value:function(t){return new e(this.x*t,this.y*t)}},{key:"div",value:function(t){return new e(this.x/t,this.y/t)}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"unit",value:function(){return 0===this.length()?this:this.div(this.length())}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y}},{key:"cross",value:function(e){return this.x*e.y-this.y*e.x}},{key:"ortho",value:function(e){return 0===e.length()?0:this.dot(e)/e.length()/e.length()}},{key:"radian",value:function(){return 0===this.x?this.y>0?.5*Math.PI:1.5*Math.PI:this.x>0?this.y>0?Math.atan(this.y/this.x):2*Math.PI+Math.atan(this.y/this.x):Math.PI+Math.atan(this.y/this.x)}},{key:"between",value:function(e,t){return this.x>=Math.min(e.x,t.x)&&this.x<=Math.max(e.x,t.x)&&this.y>=Math.min(e.y,t.y)&&this.y<=Math.max(e.y,t.y)}},{key:"toGrid",value:function(t){return new e(~~(this.x/t),~~(this.y/t))}}],[{key:"up",value:function(){return new e(0,-1)}},{key:"down",value:function(){return new e(0,1)}},{key:"left",value:function(){return new e(-1,0)}},{key:"right",value:function(){return new e(1,0)}},{key:"direction",value:function(t){return"up"===t?e.up():"down"===t?e.down():"left"===t?e.left():"right"===t?e.right():"right-up"===t?e.up().add(e.right()).unit():"right-down"===t?e.down().add(e.right()).unit():"left-up"===t?e.up().add(e.left()).unit():"left-down"===t?e.down().add(e.left()).unit():new e(0,0)}},{key:"leftUp",value:function(t,i){return new e(Math.min(t.x,i.x),Math.min(t.y,i.y))}},{key:"rightDown",value:function(t,i){return new e(Math.max(t.x,i.x),Math.max(t.y,i.y))}}]),e}(),A=i(130),R=function(){function e(){Object(C.a)(this,e),this.status=[!1,!1,!1,!1,!1],0!==arguments.length&&this.fill.apply(this,arguments)}return Object(D.a)(e,[{key:"fill",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];if(0!==t.length)for(var a=0;a<t.length;a++)t[a]<5&&t[a]>=0&&(this.status[t[a]]=!0);else this.status=[!0,!0,!0,!0,!0]}},{key:"clear",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];if(0!==t.length)for(var a=0;a<t.length;a++)t[a]<5&&t[a]>=0&&(this.status[t[a]]=!1);else this.status=[!1,!1,!1,!1,!1]}},{key:"isOverlap",value:function(e){for(var t=0;t<5;t++)if(this.status[t]&&e.status[t])return!0;return!1}},{key:"add",value:function(e){if(this.isOverlap(e))return!1;for(var t=0;t<5;t++)e.status[t]&&(this.status[t]=!0);return!0}},{key:"sub",value:function(e){for(var t=0;t<5;t++)e.status[t]&&(this.status[t]=!1)}},{key:"clone",value:function(){for(var t=[],i=0;i<5;i++)this.status[i]&&t.push(i);return Object(A.a)(e,t)}},{key:"top",value:function(){for(var e=0;e<5;e++)if(this.status[4-e])return 4-e;return-1}},{key:"bottom",value:function(){for(var e=0;e<5;e++)if(this.status[e])return e;return-1}}]),e}(),I={mapStart:new M(88,0),mapSize:new M(32,16),gridWidth:32,blockColor:"#E0E0E0",startColor:"#DFFFDF",endColor:"#FFD2D2",noneColor:"#FFFFFF",deadColor:"#EBD3E8",iceColor:"#D9FFFF",muddyColor:"#D6D6AD",boundaryColor:"#0080FF",auxiliaryColor:"#D2E9FF",typeLayerPairs:{none:new R,block:new R,start:new R(0,1,2,3),end:new R(0,1,2,3),dead:new R,ice:new R,muddy:new R},maxLayer:5,editObjectList:{platform:["platform","movingPlatform","movingPlatform_oblique","movingPlatform_rect","trapPlatform","brokenPlatform"],covering:["mucus","ice","conveyor","deathTotem"],obstacle:["block","spikedBlock","woodenBox","bow","cymbal","missileBase"],special:["portal","lockedWall","unlocker","magnet"]},editFrame:{default:{fColor:"#F0F0F0",sColor:"#BEBEBE"},platform:{fColor:"#ECECFF",sColor:"#CECEFF"},covering:{fColor:"#E8FFF5",sColor:"#96FED1"},obstacle:{fColor:"#FFECEC",sColor:"#FFB5B5"},special:{fColor:"#FFFFDF",sColor:"#FFFF37"}}},L=i(187),E=I.gridWidth,z=function(e,t){if("sphere"===e.type&&"sphere"===t.type)return e.pos.sub(t.pos).length()<=e.r+t.r;if("sphere"===e.type&&"cube"===t.type||"sphere"===t.type&&"cube"===e.type){var i="sphere"===e.type?e:t,a="cube"===e.type?e:t;if(i.pos.between(a.pos.sub(a.size.mul(.5)).sub(new M(i.r,0)),a.pos.add(a.size.mul(.5)).add(new M(i.r,0))))return!0;if(i.pos.between(a.pos.sub(a.size.mul(.5)).sub(new M(0,i.r)),a.pos.add(a.size.mul(.5)).add(new M(0,i.r))))return!0;var o=[[-.5,-.5],[.5,-.5],[.5,.5],[-.5,.5]].map((function(e){return a.pos.add(new M(e[0]*a.size.x,e[1]*a.size.y))}));return Math.min(o.map((function(e){return e.sub(i.pos)})))<=i.r}return"cube"===e.type&&"cube"===t.type&&(Math.abs(e.pos.x-t.pos.x)<=e.size.x/2+t.size.x/2&&Math.abs(e.pos.y-t.pos.y)<=e.size.y/2+t.size.y/2)},B=["#FF0000","#FFA042","#F9F900","#02DF82","#6A6AFF","#D0D0D0","#E800E8","#984B4B"],G=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new M(0,0);Object(C.a)(this,e),this.type="spikedBlock",this.id=L(),this.pos=t,this.gridPos=this.pos.sub(I.mapStart).toGrid(E),this.detail={name:"\u5c16\u523a\u65b9\u584a",upSpike:!0,downSpike:!0,leftSpike:!0,rightSpike:!0},this.loadable=!1,this.perspective=!1,this.layer=new R(3)}return Object(D.a)(e,[{key:"clone",value:function(){var t=new e;return t.unpackage(this.enpackage()),t}},{key:"setPerspective",value:function(e){this.perspective=e}},{key:"detailFunction",value:function(){return{name:{type:"text"},upSpike:{type:"check"},downSpike:{type:"check"},leftSpike:{type:"check"},rightSpike:{type:"check"}}}},{key:"enpackage",value:function(){return{type:this.type,id:this.id,gridPos:{x:this.gridPos.x,y:this.gridPos.y},name:this.detail.name,upSpike:this.detail.upSpike,downSpike:this.detail.downSpike,leftSpike:this.detail.leftSpike,rightSpike:this.detail.rightSpike}}},{key:"unpackage",value:function(e){this.type=e.type,this.id=e.id,this.gridPos=new M(e.gridPos.x,e.gridPos.y),this.pos=this.gridPos.mul(E).add(I.mapStart).add(new M(.5*E,.5*E)),this.detail.name=e.name,this.detail.upSpike=e.upSpike,this.detail.downSpike=e.downSpike,this.detail.leftSpike=e.leftSpike,this.detail.rightSpike=e.rightSpike,this.perspective=!0}},{key:"collision",value:function(e){return z({type:"cube",pos:this.pos,size:new M(E,E)},e)?"block":this.detail.leftSpike&&z({type:"cube",pos:this.pos.add(new M(-.625*E,0)),size:new M(.25*E,.75*E)},e)||this.detail.rightSpike&&z({type:"cube",pos:this.pos.add(new M(.625*E,0)),size:new M(.25*E,.75*E)},e)||this.detail.upSpike&&z({type:"cube",pos:this.pos.add(new M(0,-.625*E)),size:new M(.25*E,.75*E)},e)||this.detail.downSpike&&z({type:"cube",pos:this.pos.add(new M(0,.625*E)),size:new M(.25*E,.75*E)},e)?"spike":"none"}},{key:"draw",value:function(e){if(e.save(),e.translate(this.pos.x,this.pos.y),e.globalAlpha=this.perspective?.4:1,e.beginPath(),e.moveTo(-.5*E,-.5*E),this.detail.upSpike)for(var t=1;t<=8;t++)e.lineTo((.125*t-.5)*E,(-.5-t%2*.25)*E);if(e.lineTo(.5*E,-.5*E),this.detail.rightSpike)for(var i=1;i<=8;i++)e.lineTo((.5+i%2*.25)*E,(.125*i-.5)*E);if(e.lineTo(.5*E,.5*E),this.detail.downSpike)for(var a=1;a<=8;a++)e.lineTo((.5-.125*a)*E,(.5+a%2*.25)*E);if(e.lineTo(-.5*E,.5*E),this.detail.leftSpike)for(var o=1;o<=8;o++)e.lineTo((-.5-o%2*.25)*E,(.5-.125*o)*E);e.lineTo(-.5*E,-.5*E),e.fillStyle="#7B7B7B",e.fill(),e.strokeStyle="black",e.stroke(),e.closePath(),e.beginPath(),e.rect(-.5*E,-.5*E,E,E),e.fillStyle="#9D9D9D",e.fill(),e.strokeStyle="black",e.stroke(),e.closePath(),e.restore()}},{key:"place",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.gridPos=this.pos.sub(I.mapStart).toGrid(E);var i=this.gridPos;if(I.typeLayerPairs[e[i.y][i.x].type].isOverlap(this.layer)||this.detail.leftSpike&&i.x-1>=0&&I.typeLayerPairs[e[i.y][i.x-1].type].isOverlap(this.layer)||this.detail.upSpike&&i.y-1>=0&&I.typeLayerPairs[e[i.y-1][i.x].type].isOverlap(this.layer)||this.detail.rightSpike&&i.x+1<I.mapSize.x&&I.typeLayerPairs[e[i.y][i.x+1].type].isOverlap(this.layer)||this.detail.downSpike&&i.y+1<I.mapSize.y&&I.typeLayerPairs[e[i.y+1][i.x].type].isOverlap(this.layer))return!1;if(e[i.y][i.x].layer.isOverlap(this.layer)||this.detail.leftSpike&&i.x-1>=0&&e[i.y][i.x-1].layer.isOverlap(this.layer)||this.detail.upSpike&&i.y-1>=0&&e[i.y-1][i.x].layer.isOverlap(this.layer)||this.detail.rightSpike&&i.x+1<I.mapSize.x&&e[i.y][i.x+1].layer.isOverlap(this.layer)||this.detail.downSpike&&i.y+1<I.mapSize.y&&e[i.y+1][i.x].layer.isOverlap(this.layer))return!1;if(e[i.y][i.x].layer.add(this.layer),this.detail.leftSpike&&i.x-1>=0&&e[i.y][i.x-1].layer.add(this.layer),this.detail.upSpike&&i.y-1>=0&&e[i.y-1][i.x].layer.add(this.layer),this.detail.rightSpike&&i.x+1<I.mapSize.x&&e[i.y][i.x+1].layer.add(this.layer),this.detail.downSpike&&i.y+1<I.mapSize.y&&e[i.y+1][i.x].layer.add(this.layer),e[i.y][i.x].layer.status[2])for(var a=0;a<t.length;a++)if(t[a].gridPos.equal(i)&&2===t[a].layer.top()){t[a].loadable&&(t[a].loadObject={id:this.id,object:this});break}return!0}},{key:"remove",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=this.gridPos;if(e[i.y][i.x].layer.sub(this.layer),this.detail.leftSpike&&i.x-1>=0&&e[i.y][i.x-1].layer.sub(this.layer),this.detail.upSpike&&i.y-1>=0&&e[i.y-1][i.x].layer.sub(this.layer),this.detail.rightSpike&&i.x+1<I.mapSize.x&&e[i.y][i.x+1].layer.sub(this.layer),this.detail.downSpike&&i.y+1<I.mapSize.y&&e[i.y+1][i.x].layer.sub(this.layer),e[i.y][i.x].layer.status[2])for(var a=0;a<t.length;a++)if(t[a].gridPos.equal(i)&&2===t[a].layer.top()){t[a].loadable&&(t[a].loadObject=null);break}}}]),e}(),N=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new M(0,0);Object(C.a)(this,e),this.type="platform",this.id=L(),this.pos=t,this.gridPos=this.pos.sub(I.mapStart).toGrid(E),this.detail={name:"\u5e73\u53f0"},this.loadable=!1,this.perspective=!1,this.layer=new R(1)}return Object(D.a)(e,[{key:"clone",value:function(){var t=new e;return t.unpackage(this.enpackage()),t}},{key:"setPerspective",value:function(e){this.perspective=e}},{key:"detailFunction",value:function(){return{name:{type:"text"}}}},{key:"enpackage",value:function(){return{type:this.type,id:this.id,gridPos:{x:this.gridPos.x,y:this.gridPos.y},name:this.detail.name}}},{key:"unpackage",value:function(e){this.type=e.type,this.id=e.id,this.gridPos=new M(e.gridPos.x,e.gridPos.y),this.pos=this.gridPos.mul(E).add(I.mapStart).add(new M(.5*E,.5*E)),this.detail.name=e.name,this.perspective=!0}},{key:"collision",value:function(e){return z({type:"cube",pos:this.pos,size:new M(.99*E,.99*E)},e)?"platform":"none"}},{key:"draw",value:function(e){e.save(),e.translate(this.pos.x,this.pos.y),e.globalAlpha=this.perspective?.8:1,e.beginPath(),e.moveTo(0,-.45*E),e.arcTo(.45*E,-.45*E,.45*E,.45*E,.1*E),e.arcTo(.45*E,.45*E,-.45*E,.45*E,.1*E),e.arcTo(-.45*E,.45*E,-.45*E,-.45*E,.1*E),e.arcTo(-.45*E,-.45*E,.45*E,-.45*E,.1*E),e.lineTo(0,-.45*E),e.fillStyle="#ead48b",e.fill(),e.strokeStyle="#cb934d",e.stroke(),e.closePath(),e.beginPath(),e.moveTo(0,-.35*E),e.arcTo(.35*E,-.35*E,.35*E,.35*E,.1*E),e.arcTo(.35*E,.35*E,-.35*E,.35*E,.1*E),e.arcTo(-.35*E,.35*E,-.35*E,-.35*E,.1*E),e.arcTo(-.35*E,-.35*E,.35*E,-.35*E,.1*E),e.lineTo(0,-.35*E),e.strokeStyle="#f4f788",e.stroke(),e.closePath(),e.restore()}},{key:"place",value:function(e){this.gridPos=this.pos.sub(I.mapStart).toGrid(E);var t=this.gridPos;return!I.typeLayerPairs[e[t.y][t.x].type].isOverlap(this.layer)&&(!e[t.y][t.x].layer.isOverlap(this.layer)&&(e[t.y][t.x].layer.add(this.layer),!0))}},{key:"remove",value:function(e){var t=this.gridPos;e[t.y][t.x].layer.sub(this.layer)}}]),e}(),W=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new M(0,0);Object(C.a)(this,e),this.type="movingPlatform",this.id=L(),this.pos=t,this.gridPos=this.pos.sub(I.mapStart).toGrid(E),this.detail={name:"\u79fb\u52d5\u5e73\u53f0(\u76f4\u884c)",direction:"up",distance:1,speed:"normal"},this.loadable=!0,this.loadObject=null,this.lastRecord=Date.now(),this.active=!1,this.perspective=!1,this.layer=new R(0,1)}return Object(D.a)(e,[{key:"clone",value:function(){var t=new e;return t.unpackage(this.enpackage()),t}},{key:"setPerspective",value:function(e){this.perspective=e}},{key:"detailFunction",value:function(){return{name:{type:"text"},distance:{type:"int",min:1,max:15},direction:{type:"select",options:["up","down","left","right"]},speed:{type:"select",options:["super slow","slow","normal","fast","super fast"]}}}},{key:"enpackage",value:function(){return{type:this.type,id:this.id,gridPos:{x:this.gridPos.x,y:this.gridPos.y},name:this.detail.name,direction:this.detail.direction,distance:this.detail.distance,speed:this.detail.speed}}},{key:"unpackage",value:function(e){this.type=e.type,this.id=e.id,this.gridPos=new M(e.gridPos.x,e.gridPos.y),this.pos=this.gridPos.mul(E).add(I.mapStart).add(new M(.5*E,.5*E)),this.detail.name=e.name,this.detail.direction=e.direction,this.detail.distance=e.distance,this.detail.speed=e.speed,this.perspective=!0}},{key:"update",value:function(e,t){var i={"super slow":4e3,slow:2e3,normal:1e3,fast:500,"super fast":200},a=M.direction(this.detail.direction).mul(this.detail.distance*E),o=this.gridPos.mul(E).add(I.mapStart).add(new M(.5*E,.5*E));return~~((Date.now()-this.lastRecord)/i[this.detail.speed]/this.detail.distance)%2===0?this.pos=o.add(a.mul((Date.now()-this.lastRecord)/i[this.detail.speed]/this.detail.distance%1)):this.pos=o.add(a.mul(1-(Date.now()-this.lastRecord)/i[this.detail.speed]/this.detail.distance%1)),this.loadObject&&(this.loadObject.object.pos=this.pos),{type:"none"}}},{key:"collision",value:function(e){return z({type:"cube",pos:this.pos,size:new M(.7*E,.7*E)},e)?"movingPlatform":"none"}},{key:"draw",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;e.save();var i=this.gridPos.mul(E).add(I.mapStart).add(new M(.5*E,.5*E));if(this.active?e.translate(i.x,i.y):e.translate(this.pos.x,this.pos.y),e.globalAlpha=this.perspective?.8:1,-1===t||0===t){e.save();var a=this.detail.direction;e.rotate("up"===a?0:"down"===a?Math.PI:"left"===a?1.5*Math.PI:.5*Math.PI),e.beginPath(),e.rect(-.1*E,-.1*E,.2*E,.2*E),e.fillStyle="#4F4F4F",e.fill(),e.closePath(),e.beginPath(),e.moveTo(0,0),e.lineTo(0,-this.detail.distance*E),e.strokeStyle="#4F4F4F",e.stroke(),e.closePath(),e.save(),e.translate(0,-this.detail.distance*E),e.beginPath(),e.rect(-.1*E,-.1*E,.2*E,.2*E),e.fillStyle="#4F4F4F",e.fill(),e.closePath(),e.restore(),e.restore()}if(-1===t||1===t){if(this.active){var o=this.pos.sub(i);e.translate(o.x,o.y)}e.beginPath(),e.moveTo(0,-.45*E),e.arcTo(.45*E,-.45*E,.45*E,.45*E,.1*E),e.arcTo(.45*E,.45*E,-.45*E,.45*E,.1*E),e.arcTo(-.45*E,.45*E,-.45*E,-.45*E,.1*E),e.arcTo(-.45*E,-.45*E,.45*E,-.45*E,.1*E),e.lineTo(0,-.45*E),e.fillStyle="#ead48b",e.fill(),e.strokeStyle="#cb934d",e.stroke(),e.closePath(),e.beginPath(),e.moveTo(0,-.35*E),e.arcTo(.35*E,-.35*E,.35*E,.35*E,.1*E),e.arcTo(.35*E,.35*E,-.35*E,.35*E,.1*E),e.arcTo(-.35*E,.35*E,-.35*E,-.35*E,.1*E),e.arcTo(-.35*E,-.35*E,.35*E,-.35*E,.1*E),e.lineTo(0,-.35*E),e.strokeStyle="#f4f788",e.stroke(),e.closePath()}e.restore()}},{key:"place",value:function(e,t){this.active=!0,this.lastRecord=Date.now(),this.gridPos=this.pos.sub(I.mapStart).toGrid(E);var i=this.gridPos;if(I.typeLayerPairs[e[i.y][i.x].type].isOverlap(this.layer))return!1;if(e[i.y][i.x].layer.isOverlap(this.layer))return!1;if(e[i.y][i.x].layer.add(this.layer),e[i.y][i.x].layer.status[2])for(var a=0;a<t.length;a++)if(t[a].gridPos.equal(i)&&2===t[a].layer.top()){this.loadObject={id:t[a].id,object:t[a]};break}return!0}},{key:"remove",value:function(e){this.active=!1;var t=this.gridPos;e[t.y][t.x].layer.sub(this.layer)}}]),e}(),q=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new M(0,0);Object(C.a)(this,e),this.type="bow",this.id=L(),this.pos=t,this.gridPos=this.pos.sub(I.mapStart).toGrid(E),this.detail={name:"\u5f13\u7bad\u5ea7",direction:"up",RoF:"normal"},this.loadable=!1,this.lastFire=Date.now(),this.lifeCycle=0,this.active=!1,this.perspective=!1,this.layer=new R(3)}return Object(D.a)(e,[{key:"clone",value:function(){var t=new e;return t.unpackage(this.enpackage()),t}},{key:"setPerspective",value:function(e){this.perspective=e}},{key:"detailFunction",value:function(){return{name:{type:"text"},direction:{type:"select",options:["up","down","left","right"]},RoF:{type:"select",options:["super slow","slow","normal","fast","super fast"]}}}},{key:"enpackage",value:function(){return{type:this.type,id:this.id,gridPos:{x:this.gridPos.x,y:this.gridPos.y},name:this.detail.name,direction:this.detail.direction,RoF:this.detail.RoF}}},{key:"unpackage",value:function(e){this.type=e.type,this.id=e.id,this.gridPos=new M(e.gridPos.x,e.gridPos.y),this.pos=this.gridPos.mul(E).add(I.mapStart).add(new M(.5*E,.5*E)),this.detail.name=e.name,this.detail.direction=e.direction,this.detail.RoF=e.RoF,this.perspective=!0}},{key:"update",value:function(e,t){var i={"super slow":8e3,slow:5e3,normal:3e3,fast:1e3,"super fast":500};if(this.lifeCycle=this.active?(Date.now()-this.lastFire)/i[this.detail.RoF]:0,this.lifeCycle=this.lifeCycle>.5?(this.lifeCycle-.5)/.5:0,Date.now()>this.lastFire+i[this.detail.RoF]){this.lastFire=Date.now();var a=M.direction(this.detail.direction).mul(.5*E),o={type:"produce",object:new Y(this.pos.add(a))};return o.object.detail.direction=this.detail.direction,o}return{type:"none"}}},{key:"draw",value:function(e){e.save(),e.translate(this.pos.x,this.pos.y),e.globalAlpha=this.perspective?.8:1;var t=this.detail.direction;e.rotate("up"===t?0:"down"===t?Math.PI:"left"===t?1.5*Math.PI:.5*Math.PI);var i=new M(0,.05).add(new M(0,.35).mul(this.lifeCycle));if(this.lifeCycle>0){var a=new Y(i.mul(E).sub(new M(0,.9*E)));a.draw(e)}e.beginPath(),e.moveTo(-.45*E,.05*E),e.lineTo(i.x*E,i.y*E),e.lineTo(.45*E,.05*E),e.strokeStyle="#9D9D9D",e.stroke(),e.closePath(),e.beginPath(),e.arc(0,.2*E,.45*E,-.95*Math.PI,-.05*Math.PI),e.arc(0,.2*E,.55*E,-.05*Math.PI,-.95*Math.PI,!0),e.arc(0,.2*E,.45*E,-.95*Math.PI,-.95*Math.PI),e.fillStyle="#D26900",e.fill(),e.strokeStyle="#272727",e.stroke(),e.closePath(),e.restore()}},{key:"place",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.active=!0,this.lastFire=Date.now(),this.lifeCycle=0,this.gridPos=this.pos.sub(I.mapStart).toGrid(E);var i=this.gridPos;if(I.typeLayerPairs[e[i.y][i.x].type].isOverlap(this.layer))return!1;if(e[i.y][i.x].layer.isOverlap(this.layer))return!1;if(e[i.y][i.x].layer.add(this.layer),e[i.y][i.x].layer.status[2])for(var a=0;a<t.length;a++)if(t[a].gridPos.equal(i)&&2===t[a].layer.top()){t[a].loadable&&(t[a].loadObject={id:this.id,object:this});break}return!0}},{key:"remove",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.active=!1;var i=this.gridPos;if(e[i.y][i.x].layer.sub(this.layer),e[i.y][i.x].layer.status[2])for(var a=0;a<t.length;a++)if(t[a].gridPos.equal(i)&&2===t[a].layer.top()){t[a].loadable&&(t[a].loadObject=null);break}}}]),e}(),Y=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new M(0,0);Object(C.a)(this,e),this.type="arrow",this.id=L(),this.pos=t,this.gridPos=new M(-1,-1),this.detail={name:"\u7bad",direction:"up"},this.loadable=!1,this.perspective=!1,this.speed=3,this.lastRecord=Date.now(),this.layer=new R(3)}return Object(D.a)(e,[{key:"clone",value:function(){var t=new e;return t.unpackage(this.enpackage()),t}},{key:"setPerspective",value:function(e){this.perspective=e}},{key:"update",value:function(e,t){if(!this.pos.between(I.mapStart,I.mapStart.add(I.mapSize.mul(E))))return{type:"destory"};for(var i=0;i<e.length;i++)if(e[i].id!==this.id&&e[i].collision){var a=e[i].collision({type:"sphere",pos:this.pos,r:.1});if("ice"===a)this.speed*=1.03;else if("portal"===a)this.pos=e[i].teleport(e);else{if("woodenBox"===a)return{type:"destory"};if("magneticField"===a)this.pos=this.pos.add(e[i].getDisplacement());else if("block"===a||"lockedWall"===a)return{type:"destory"}}}var o=M.direction(this.detail.direction).mul(this.speed*E);return this.pos=this.pos.add(o.mul((Date.now()-this.lastRecord)/1e3)),this.lastRecord=Date.now(),{type:"none"}}},{key:"collision",value:function(e){return z({type:"sphere",pos:this.pos,r:.1},e)?"arrow":"none"}},{key:"draw",value:function(e){e.save(),e.translate(this.pos.x,this.pos.y),e.globalAlpha=this.perspective?.9:1;var t=this.detail.direction;e.rotate("up"===t?0:"down"===t?Math.PI:"left"===t?1.5*Math.PI:.5*Math.PI),e.beginPath(),e.moveTo(0,0),e.lineTo(.12*E,.2*E),e.lineTo(-.12*E,.2*E),e.lineTo(0,0),e.fillStyle="#FCFCFC",e.fill(),e.strokeStyle="#9D9D9D",e.stroke(),e.closePath(),e.beginPath(),e.moveTo(0,.2*E),e.lineTo(0,.8*E),e.strokeStyle="#AD5A5A",e.stroke(),e.closePath(),e.translate(0,.8*E);for(var i=0;i<2;i++)1===i&&e.scale(-1,1),e.beginPath(),e.moveTo(0,0),e.lineTo(.12*E,.06*E),e.lineTo(.12*E,.18*E),e.lineTo(0,.12*E),e.lineTo(0,0),e.fillStyle="#00DB00",e.fill(),e.strokeStyle="#9D9D9D",e.stroke(),e.closePath();e.restore()}}]),e}(),X=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new M(0,0);Object(C.a)(this,e),this.type="mucus",this.id=L(),this.pos=t,this.gridPos=this.pos.sub(I.mapStart).toGrid(E),this.detail={name:"\u9ecf\u6db2"},this.loadable=!0,this.loadObject=null,this.perspective=!1,this.layer=new R(2)}return Object(D.a)(e,[{key:"clone",value:function(){var t=new e;return t.unpackage(this.enpackage()),t}},{key:"setPerspective",value:function(e){this.perspective=e}},{key:"detailFunction",value:function(){return{name:{type:"text"}}}},{key:"enpackage",value:function(){return{type:this.type,id:this.id,gridPos:{x:this.gridPos.x,y:this.gridPos.y},name:this.detail.name}}},{key:"unpackage",value:function(e){this.type=e.type,this.id=e.id,this.gridPos=new M(e.gridPos.x,e.gridPos.y),this.pos=this.gridPos.mul(E).add(I.mapStart).add(new M(.5*E,.5*E)),this.detail.name=e.name,this.perspective=!0}},{key:"update",value:function(e,t){return this.loadObject&&(this.loadObject.object.pos=this.pos.clone()),{type:"none"}}},{key:"collision",value:function(e){return z({type:"cube",pos:this.pos,size:new M(.7*E,.7*E)},e)?"mucus":"none"}},{key:"draw",value:function(e){e.save(),e.translate(this.pos.x,this.pos.y),e.globalAlpha=this.perspective?.8:1,e.beginPath(),e.moveTo(0,-.35*E),e.arcTo(.35*E,-.35*E,.35*E,.35*E,.1*E),e.arcTo(.35*E,.35*E,-.35*E,.35*E,.1*E),e.arcTo(-.35*E,.35*E,-.35*E,-.35*E,.1*E),e.arcTo(-.35*E,-.35*E,.35*E,-.35*E,.1*E),e.lineTo(0,-.35*E);var t=e.createLinearGradient(-.4*E,-.4*E,.4*E,.4*E);t.addColorStop(0,"#B7FF4A"),t.addColorStop(.4,"#FFDC35"),t.addColorStop(.6,"#FFDC35"),t.addColorStop(1,"#B7FF4A"),e.fillStyle=t,e.fill(),e.strokeStyle="#E1E100",e.stroke(),e.closePath(),e.restore()}},{key:"place",value:function(e,t){this.gridPos=this.pos.sub(I.mapStart).toGrid(E);var i=this.gridPos;if(I.typeLayerPairs[e[i.y][i.x].type].isOverlap(this.layer))return!1;if(e[i.y][i.x].layer.isOverlap(this.layer))return!1;if(e[i.y][i.x].layer.add(this.layer),e[i.y][i.x].layer.status[1])for(var a=0;a<t.length;a++)if(t[a].gridPos.equal(i)&&1===t[a].layer.top()){t[a].loadable&&(t[a].loadObject={id:this.id,object:this});break}if(e[i.y][i.x].layer.status[3])for(var o=0;o<t.length;o++)if(t[o].gridPos.equal(i)&&3===t[o].layer.top()){this.loadObject={id:t[o].id,object:t[o]};break}return!0}},{key:"remove",value:function(e,t){var i=this.gridPos;if(e[i.y][i.x].layer.sub(this.layer),e[i.y][i.x].layer.status[1])for(var a=0;a<t.length;a++)if(t[a].gridPos.equal(i)&&1===t[a].layer.top()){t[a].loadable&&(t[a].loadObject=null);break}this.loadObject&&(this.loadObject=null)}}]),e}(),_=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new M(0,0);Object(C.a)(this,e),this.type="cymbal",this.id=L(),this.pos=t,this.gridPos=this.pos.sub(I.mapStart).toGrid(E),this.detail={name:"\u97f3\u9238",RoF:"normal",range:"normal"},this.loadable=!1,this.lastFire=Date.now(),this.lifeCycle=0,this.active=!1,this.perspective=!1,this.layer=new R(3)}return Object(D.a)(e,[{key:"clone",value:function(){var t=new e;return t.unpackage(this.enpackage()),t}},{key:"setPerspective",value:function(e){this.perspective=e}},{key:"detailFunction",value:function(){return{name:{type:"text"},RoF:{type:"select",options:["slow","normal","fast"]},range:{type:"select",options:["small","normal","large"]}}}},{key:"enpackage",value:function(){return{type:this.type,id:this.id,gridPos:{x:this.gridPos.x,y:this.gridPos.y},name:this.detail.name,direction:this.detail.direction,RoF:this.detail.RoF,range:this.detail.range}}},{key:"unpackage",value:function(e){this.type=e.type,this.id=e.id,this.gridPos=new M(e.gridPos.x,e.gridPos.y),this.pos=this.gridPos.mul(E).add(I.mapStart).add(new M(.5*E,.5*E)),this.detail.name=e.name,this.detail.direction=e.direction,this.detail.RoF=e.RoF,this.detail.range=e.range,this.perspective=!0}},{key:"update",value:function(e,t){var i={slow:12e3,normal:8e3,fast:4e3};if(this.lifeCycle=this.active?(Date.now()-this.lastFire)/i[this.detail.RoF]:0,this.lifeCycle=Math.min(1,this.lifeCycle),Date.now()>this.lastFire+i[this.detail.RoF]){this.lastFire=Date.now();var a={type:"produce",object:new U(this.pos)};return a.object.r=.4*E,a.object.detail.range=this.detail.range,a}return{type:"none"}}},{key:"collision",value:function(e){return z({type:"sphere",pos:this.pos,r:.48*E},e)?"cymbal":"none"}},{key:"draw",value:function(e){e.save(),e.translate(this.pos.x,this.pos.y),e.globalAlpha=this.perspective?.8:1;var t={slow:12e3,normal:8e3,fast:4e3},i=.96+25e-7*t[this.detail.RoF],a=this.lifeCycle<i?.05+.4*this.lifeCycle/i:.05+.4*(1-this.lifeCycle)/(1-i);e.save(),e.rotate(8*this.lifeCycle*Math.PI),e.beginPath(),e.arc(0,0,.48*E,0,2*Math.PI);var o=e.createRadialGradient(-.13*E,-.13*E,0,0,0,.48*E);o.addColorStop(0,"white"),o.addColorStop(1,"#D6D6AD"),e.fillStyle=o,e.fill(),e.strokeStyle="#B9B973",e.stroke(),e.closePath(),e.restore(),e.save(),e.globalAlpha*=.5,e.beginPath(),e.arc(0,0,.4*E,0*Math.PI,2*Math.PI),e.strokeStyle="#CDCD9A",e.stroke(),e.closePath(),e.restore(),e.beginPath(),e.globalAlpha*=.5,e.arc(0,0,a*E,0,2*Math.PI),e.lineWidth=1.3,e.strokeStyle="white",e.stroke(),e.closePath(),e.beginPath(),e.arc(0,0,.06*E,0,2*Math.PI),e.fillStyle="#EAC100",e.fill(),e.closePath(),e.restore()}},{key:"place",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.active=!0,this.lastFire=Date.now(),this.lifeCycle=0,this.gridPos=this.pos.sub(I.mapStart).toGrid(E);var i=this.gridPos;if(I.typeLayerPairs[e[i.y][i.x].type].isOverlap(this.layer))return!1;if(e[i.y][i.x].layer.isOverlap(this.layer))return!1;if(e[i.y][i.x].layer.add(this.layer),e[i.y][i.x].layer.status[2])for(var a=0;a<t.length;a++)if(t[a].gridPos.equal(i)&&2===t[a].layer.top()){t[a].loadable&&(t[a].loadObject={id:this.id,object:this});break}return!0}},{key:"remove",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.active=!1;var i=this.gridPos;if(e[i.y][i.x].layer.sub(this.layer),e[i.y][i.x].layer.status[2])for(var a=0;a<t.length;a++)if(t[a].gridPos.equal(i)&&2===t[a].layer.top()){t[a].loadable&&(t[a].loadObject=null);break}}}]),e}(),U=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new M(0,0);Object(C.a)(this,e),this.type="cymbalWave",this.id=L(),this.pos=t,this.gridPos=new M(-1,-1),this.detail={name:"\u97f3\u6ce2",range:"normal"},this.loadable=!1,this.perspective=!1,this.r=0,this.lastRecord=Date.now(),this.layer=new R(3)}return Object(D.a)(e,[{key:"clone",value:function(){var e=new Y;return e.unpackage(this.enpackage()),e}},{key:"setPerspective",value:function(e){this.perspective=e}},{key:"update",value:function(e,t){return this.r>E*{small:1.5,normal:2.5,large:3.5}[this.detail.range]?{type:"destory"}:(this.r=.4*E+.5*E*(Date.now()-this.lastRecord)/1e3,{type:"none"})}},{key:"collision",value:function(e){return z({type:"sphere",pos:this.pos,r:this.r},e)?"cymbalWave":"none"}},{key:"draw",value:function(e){e.save(),e.translate(this.pos.x,this.pos.y);var t={small:1.5,normal:2.5,large:3.5};e.globalAlpha=.3*Math.max(1.1-Math.pow(this.r/(E*t[this.detail.range]),16),0),e.beginPath(),e.arc(0,0,this.r,0,2*Math.PI);var i=e.createRadialGradient(0,0,0,0,0,this.r);i.addColorStop(0,"white"),i.addColorStop(.4,"white"),i.addColorStop(.95,"#FFFF37"),i.addColorStop(1,"#E1E100"),e.fillStyle=i,e.fill(),e.closePath(),e.restore()}}]),e}(),H=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new M(0,0);Object(C.a)(this,e),this.type="ice",this.id=L(),this.pos=t,this.gridPos=this.pos.sub(I.mapStart).toGrid(E),this.detail={name:"\u51b0\u5c64"},this.loadable=!1,this.perspective=!1,this.layer=new R(2)}return Object(D.a)(e,[{key:"clone",value:function(){var t=new e;return t.unpackage(this.enpackage()),t}},{key:"setPerspective",value:function(e){this.perspective=e}},{key:"detailFunction",value:function(){return{name:{type:"text"}}}},{key:"enpackage",value:function(){return{type:this.type,id:this.id,gridPos:{x:this.gridPos.x,y:this.gridPos.y},name:this.detail.name}}},{key:"unpackage",value:function(e){this.type=e.type,this.id=e.id,this.gridPos=new M(e.gridPos.x,e.gridPos.y),this.pos=this.gridPos.mul(E).add(I.mapStart).add(new M(.5*E,.5*E)),this.detail.name=e.name,this.perspective=!0}},{key:"collision",value:function(e){return z({type:"cube",pos:this.pos,size:new M(.7*E,.7*E)},e)?"ice":"none"}},{key:"draw",value:function(e){e.save(),e.translate(this.pos.x,this.pos.y),e.globalAlpha=this.perspective?.8:1,e.beginPath(),e.moveTo(0,-.35*E),e.arcTo(.35*E,-.35*E,.35*E,.35*E,.1*E),e.arcTo(.35*E,.35*E,-.35*E,.35*E,.1*E),e.arcTo(-.35*E,.35*E,-.35*E,-.35*E,.1*E),e.arcTo(-.35*E,-.35*E,.35*E,-.35*E,.1*E),e.lineTo(0,-.35*E);var t=e.createLinearGradient(-.4*E,-.4*E,.4*E,.4*E);t.addColorStop(0,"#CAFFFF"),t.addColorStop(.12,"white"),t.addColorStop(.15,"white"),t.addColorStop(.4,"#CAFFFF"),t.addColorStop(.6,"#CAFFFF"),t.addColorStop(.85,"white"),t.addColorStop(.88,"white"),t.addColorStop(1,"#CAFFFF"),e.fillStyle=t,e.fill(),e.strokeStyle="#ACD6FF",e.stroke(),e.closePath(),e.restore()}},{key:"place",value:function(e,t){this.gridPos=this.pos.sub(I.mapStart).toGrid(E);var i=this.gridPos;if(I.typeLayerPairs[e[i.y][i.x].type].isOverlap(this.layer))return!1;if(e[i.y][i.x].layer.isOverlap(this.layer))return!1;if(e[i.y][i.x].layer.add(this.layer),e[i.y][i.x].layer.status[1])for(var a=0;a<t.length;a++)if(t[a].gridPos.equal(i)&&1===t[a].layer.top()){t[a].loadable&&(t[a].loadObject={id:this.id,object:this});break}return!0}},{key:"remove",value:function(e,t){var i=this.gridPos;if(e[i.y][i.x].layer.sub(this.layer),e[i.y][i.x].layer.status[1])for(var a=0;a<t.length;a++)if(t[a].gridPos.equal(i)&&1===t[a].layer.top()){t[a].loadable&&(t[a].loadObject=null);break}}}]),e}(),V=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new M(0,0);Object(C.a)(this,e),this.type="conveyor",this.id=L(),this.pos=t,this.gridPos=this.pos.sub(I.mapStart).toGrid(E),this.detail={name:"\u50b3\u8f38\u5e36",direction:"right"},this.loadable=!1,this.perspective=!1,this.layer=new R(2)}return Object(D.a)(e,[{key:"clone",value:function(){var t=new e;return t.unpackage(this.enpackage()),t}},{key:"setPerspective",value:function(e){this.perspective=e}},{key:"detailFunction",value:function(){return{name:{type:"text"},direction:{type:"select",options:["up","down","left","right"]}}}},{key:"enpackage",value:function(){return{type:this.type,id:this.id,gridPos:{x:this.gridPos.x,y:this.gridPos.y},name:this.detail.name,direction:this.detail.direction}}},{key:"unpackage",value:function(e){this.type=e.type,this.id=e.id,this.gridPos=new M(e.gridPos.x,e.gridPos.y),this.pos=this.gridPos.mul(E).add(I.mapStart).add(new M(.5*E,.5*E)),this.detail.name=e.name,this.detail.direction=e.direction,this.perspective=!0}},{key:"collision",value:function(e){return z({type:"cube",pos:this.pos,size:new M(.7*E,.7*E)},e)?"conveyor":"none"}},{key:"draw",value:function(e){e.save(),e.translate(this.pos.x,this.pos.y),e.globalAlpha=this.perspective?.8:1,e.beginPath(),e.moveTo(0,-.35*E),e.arcTo(.35*E,-.35*E,.35*E,.35*E,.1*E),e.arcTo(.35*E,.35*E,-.35*E,.35*E,.1*E),e.arcTo(-.35*E,.35*E,-.35*E,-.35*E,.1*E),e.arcTo(-.35*E,-.35*E,.35*E,-.35*E,.1*E),e.lineTo(0,-.35*E),e.fillStyle="#BE77FF",e.fill(),e.strokeStyle="#9F35FF",e.stroke(),e.closePath(),e.rect(-.34*E,-.34*E,.68*E,.68*E),e.clip();var t=this.detail.direction;e.rotate("right"===t?0:"left"===t?Math.PI:"up"===t?1.5*Math.PI:.5*Math.PI),e.beginPath(),e.moveTo(-.4*E,-.15*E),e.lineTo(-.05*E,-.15*E),e.lineTo(-.05*E,-.4*E),e.lineTo(.4*E,0),e.lineTo(-.05*E,.4*E),e.lineTo(-.05*E,.15*E),e.lineTo(-.4*E,.15*E),e.lineTo(-.4*E,-.15*E),e.fillStyle="#FFA6FF",e.fill(),e.strokeStyle="#D3A4FF",e.stroke(),e.closePath(),e.restore()}},{key:"place",value:function(e,t){this.gridPos=this.pos.sub(I.mapStart).toGrid(E);var i=this.gridPos;if(I.typeLayerPairs[e[i.y][i.x].type].isOverlap(this.layer))return!1;if(e[i.y][i.x].layer.isOverlap(this.layer))return!1;if(e[i.y][i.x].layer.add(this.layer),e[i.y][i.x].layer.status[1])for(var a=0;a<t.length;a++)if(t[a].gridPos.equal(i)&&1===t[a].layer.top()){t[a].loadable&&(t[a].loadObject={id:this.id,object:this});break}return!0}},{key:"remove",value:function(e,t){var i=this.gridPos;if(e[i.y][i.x].layer.sub(this.layer),e[i.y][i.x].layer.status[1])for(var a=0;a<t.length;a++)if(t[a].gridPos.equal(i)&&1===t[a].layer.top()){t[a].loadable&&(t[a].loadObject=null);break}}}]),e}(),K=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new M(0,0);Object(C.a)(this,e),this.type="portal",this.id=L(),this.pos=t,this.gridPos=this.pos.sub(I.mapStart).toGrid(E),this.detail={name:"\u50b3\u9001\u9580"},this.loadable=!1,this.open=!1,this.index=-1,this.cooldown=!1,this.lastClose=0,this.cooldownTime=2989,this.cooldownCycle=0,this.perspective=!1,this.layer=new R(3)}return Object(D.a)(e,[{key:"clone",value:function(){var t=new e;return t.unpackage(this.enpackage()),t}},{key:"setPerspective",value:function(e){this.perspective=e}},{key:"detailFunction",value:function(){return{name:{type:"text"}}}},{key:"enpackage",value:function(){return{type:this.type,id:this.id,gridPos:{x:this.gridPos.x,y:this.gridPos.y},name:this.detail.name,index:this.index}}},{key:"unpackage",value:function(e){this.type=e.type,this.id=e.id,this.gridPos=new M(e.gridPos.x,e.gridPos.y),this.pos=this.gridPos.mul(E).add(I.mapStart).add(new M(.5*E,.5*E)),this.detail.name=e.name,this.index=e.index,this.perspective=!0}},{key:"update",value:function(e,t){return this.cooldown&&(Date.now()>this.lastClose+this.cooldownTime?(this.cooldown=!1,this.open=!0):this.cooldownCycle=(Date.now()-this.lastClose)/this.cooldownTime),{type:"none"}}},{key:"collision",value:function(e){return this.open&&z({type:"cube",pos:this.pos,size:new M(.6*E,.6*E)},e)?"portal":"none"}},{key:"teleport",value:function(e){this.open=!1,this.cooldown=!0,this.lastClose=Date.now();for(var t=0;t<e.length;t++)if("portal"===e[t].type&&e[t].index===this.index&&e[t].id!==this.id)return e[t].open=!1,e[t].cooldown=!0,e[t].lastClose=Date.now(),e[t].pos.clone();return this.pos.clone()}},{key:"draw",value:function(e){e.save(),e.translate(this.pos.x,this.pos.y),e.globalAlpha=this.perspective?.8:1,e.beginPath(),e.rect(-.36*E,-.36*E,.72*E,.72*E),e.lineWidth=5,e.strokeStyle="#4B0091",e.stroke(),e.closePath(),e.beginPath(),e.rect(-.4*E,-.4*E,.8*E,.8*E),e.lineWidth=.2,e.strokeStyle="black",e.stroke(),e.closePath(),e.beginPath(),e.rect(-.32*E,-.32*E,.64*E,.64*E),e.lineWidth=.2,e.strokeStyle="black",e.stroke(),e.closePath(),e.rect(-.3*E,-.3*E,.6*E,.6*E),e.clip(),e.globalAlpha=this.open?.95:this.cooldown?this.cooldownCycle<.1?.2+.75*(1-10*this.cooldownCycle):this.cooldownCycle>.9?.2+.75*(1-10*(1-this.cooldownCycle)):.2:.2,e.beginPath(),e.rect(-.32*E,-.32*E,.64*E,.64*E);var t=(this.open||this.cooldown)&&this.index>=0?B[this.index]:"white",i=e.createRadialGradient(0,0,0,0,0,.4*E);i.addColorStop(0,t),i.addColorStop(.15,"#3C3C3C"),i.addColorStop(.3,t),i.addColorStop(.45,"#3C3C3C"),i.addColorStop(.6,t),i.addColorStop(.75,"#3C3C3C"),i.addColorStop(.9,t),i.addColorStop(1,"#3C3C3C"),e.fillStyle=i,e.fill(),e.closePath(),e.restore()}},{key:"place",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.cooldown=!1,this.gridPos=this.pos.sub(I.mapStart).toGrid(E);var i=this.gridPos;if(I.typeLayerPairs[e[i.y][i.x].type].isOverlap(this.layer))return!1;if(e[i.y][i.x].layer.isOverlap(this.layer))return!1;if(-1===this.index){for(var a=[0,0,0,0,0,0,0,0],o=0;o<t.length;o++)"portal"===t[o].type&&(a[t[o].index]+=1);for(var s=0;s<a.length;s++)if(1===a[s]){this.index=s,this.open=!0;for(var n=0;n<t.length;n++)"portal"===t[n].type&&t[n].index===s&&(t[n].open=!0);break}if(-1===this.index)for(var r=0;r<a.length;r++)if(0===a[r]){this.index=r,this.open=!1;break}}else for(var l=0;l<t.length;l++)"portal"===t[l].type&&t[l].index===this.index&&t[l].id!=this.id&&(t[l].open=!0,this.open=!0);if(-1===this.index)return!1;if(e[i.y][i.x].layer.add(this.layer),e[i.y][i.x].layer.status[2])for(var c=0;c<t.length;c++)if(t[c].gridPos.equal(i)&&2===t[c].layer.top()){t[c].loadable&&(t[c].loadObject={id:this.id,object:this});break}return!0}},{key:"remove",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=0;i<t.length;i++)if("portal"===t[i].type&&t[i].index===this.index&&t[i].id!=this.id){t[i].cooldown=!1,t[i].open=!1;break}this.index=-1,this.open=!1,this.cooldown=!1;var a=this.gridPos;if(e[a.y][a.x].layer.sub(this.layer),e[a.y][a.x].layer.status[2])for(var o=0;o<t.length;o++)if(t[o].gridPos.equal(a)&&2===t[o].layer.top()){t[o].loadable&&(t[o].loadObject=null);break}}}]),e}(),Q=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new M(0,0);Object(C.a)(this,e),this.type="trapPlatform",this.id=L(),this.pos=t,this.gridPos=this.pos.sub(I.mapStart).toGrid(E),this.detail={name:"\u9677\u9631\u5e73\u53f0",duration:"normal"},this.loadable=!1,this.open=!1,this.lastChange=Date.now(),this.openCycle=0,this.perspective=!1,this.layer=new R(1,2)}return Object(D.a)(e,[{key:"clone",value:function(){var t=new e;return t.unpackage(this.enpackage()),t}},{key:"setPerspective",value:function(e){this.perspective=e}},{key:"detailFunction",value:function(){return{name:{type:"text"},duration:{type:"select",options:["short","normal","long"]}}}},{key:"enpackage",value:function(){return{type:this.type,id:this.id,gridPos:{x:this.gridPos.x,y:this.gridPos.y},name:this.detail.name,duration:this.detail.duration}}},{key:"unpackage",value:function(e){this.type=e.type,this.id=e.id,this.gridPos=new M(e.gridPos.x,e.gridPos.y),this.pos=this.gridPos.mul(E).add(I.mapStart).add(new M(.5*E,.5*E)),this.detail.name=e.name,this.detail.duration=e.duration,this.perspective=!0}},{key:"update",value:function(e,t){var i={short:3e3,normal:6e3,long:9e3};return this.open?(this.openCycle=(Date.now()-this.lastChange)/i[this.detail.duration],this.openCycle=this.openCycle<600/i[this.detail.duration]?this.openCycle/(600/i[this.detail.duration]):this.openCycle>1-600/i[this.detail.duration]?(1-this.openCycle)/(600/i[this.detail.duration]):1,Date.now()>this.lastChange+i[this.detail.duration]&&(this.open=!1,this.lastChange=Date.now())):(this.openCycle=0,Date.now()>this.lastChange+i[this.detail.duration]&&(this.open=!0,this.lastChange=Date.now())),{type:"none"}}},{key:"collision",value:function(e){return this.open&&z({type:"cube",pos:this.pos,size:new M(.6*E*this.openCycle,.7*E)},e)?"trap":z({type:"cube",pos:this.pos,size:new M(.7*E,.7*E)},e)?"platform":"none"}},{key:"draw",value:function(e){e.save(),e.translate(this.pos.x,this.pos.y),e.globalAlpha=this.perspective?.6:1,e.beginPath(),e.rect(-.39*E,-.39*E,.78*E,.78*E),e.strokeStyle="#ADADAD",e.stroke(),e.closePath();for(var t=0;t<2;t++){if(e.save(),this.open){var i=0===t?-1:1;e.beginPath(),e.moveTo(-.05*E+i*(.3*E)*this.openCycle,-.35*E),e.lineTo(.05*E+i*(.3*E)*this.openCycle,-.25*E),e.lineTo(-.05*E+i*(.3*E)*this.openCycle,-.15*E),e.lineTo(.05*E+i*(.3*E)*this.openCycle,-.05*E),e.lineTo(-.05*E+i*(.3*E)*this.openCycle,.05*E),e.lineTo(.05*E+i*(.3*E)*this.openCycle,.15*E),e.lineTo(-.05*E+i*(.3*E)*this.openCycle,.25*E),e.lineTo(.05*E+i*(.3*E)*this.openCycle,.35*E),e.lineTo(.35*E*i,.35*E),e.lineTo(.35*E*i,-.35*E),e.lineTo(-.05*E+i*(.3*E)*this.openCycle,-.35*E),e.clip(),e.closePath()}e.beginPath(),e.rect(-.35*E,-.35*E,.7*E,.7*E),e.fillStyle="#E0E0E0",e.fill(),e.closePath(),e.restore()}e.beginPath(),e.rect(-.43*E,-.43*E,.86*E,.86*E),e.strokeStyle="#3C3C3C",e.stroke(),e.closePath(),e.beginPath(),e.rect(-.35*E,-.35*E,.7*E,.7*E),e.strokeStyle="#3C3C3C",e.stroke(),e.closePath();for(var a=0;a<2;a++)e.save(),this.open&&(0===a?e.translate(-.3*E*this.openCycle,0):e.translate(.3*E*this.openCycle,0)),e.beginPath(),e.moveTo(-.05*E,-.35*E),e.lineTo(.05*E,-.25*E),e.lineTo(-.05*E,-.15*E),e.lineTo(.05*E,-.05*E),e.lineTo(-.05*E,.05*E),e.lineTo(.05*E,.15*E),e.lineTo(-.05*E,.25*E),e.lineTo(.05*E,.35*E),e.strokeStyle="#6C6C6C",e.stroke(),e.closePath(),e.restore();e.restore()}},{key:"place",value:function(e){this.gridPos=this.pos.sub(I.mapStart).toGrid(E);var t=this.gridPos;return!I.typeLayerPairs[e[t.y][t.x].type].isOverlap(this.layer)&&(!e[t.y][t.x].layer.isOverlap(this.layer)&&(e[t.y][t.x].layer.add(this.layer),!0))}},{key:"remove",value:function(e){var t=this.gridPos;e[t.y][t.x].layer.sub(this.layer)}}]),e}(),J=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new M(0,0);Object(C.a)(this,e),this.type="missileBase",this.id=L(),this.pos=t,this.gridPos=this.pos.sub(I.mapStart).toGrid(E),this.detail={name:"\u8ffd\u8e64\u5c0e\u5f48\u767c\u5c04\u53f0",direction:"up",rotate:!0},this.loadable=!1,this.active=!1,this.r=2.5,this.range=.125,this.lastFire=Date.now(),this.unfoldTime=500,this.unfoldCycle=0,this.rotateSpeed=.2,this.rotateCycle=0,this.find=!1,this.findTarget=null,this.lastFind=0,this.findCycle=0,this.findTime=2500,this.perspective=!1,this.layer=new R(3)}return Object(D.a)(e,[{key:"clone",value:function(){var t=new e;return t.unpackage(this.enpackage()),t}},{key:"setPerspective",value:function(e){this.perspective=e}},{key:"detailFunction",value:function(){return{name:{type:"text"},direction:{type:"select",options:["up","down","left","right"]},rotate:{type:"check"}}}},{key:"enpackage",value:function(){return{type:this.type,id:this.id,gridPos:{x:this.gridPos.x,y:this.gridPos.y},name:this.detail.name,direction:this.detail.direction,rotate:this.detail.rotate}}},{key:"unpackage",value:function(e){this.type=e.type,this.id=e.id,this.gridPos=new M(e.gridPos.x,e.gridPos.y),this.pos=this.gridPos.mul(E).add(I.mapStart).add(new M(.5*E,.5*E)),this.detail.name=e.name,this.detail.direction=e.direction,this.detail.rotate=e.rotate,this.perspective=!0}},{key:"update",value:function(e,t){if(this.unfoldCycle=(Date.now()-this.lastFire)/this.unfoldTime,this.unfoldCycle=this.unfoldCycle>1?1:this.unfoldCycle,this.rotateCycle=1===this.unfoldCycle&&this.detail.rotate?(Date.now()-this.lastFire-this.unfoldTime)/1e3*this.rotateSpeed:0,this.find&&(this.findCycle=(Date.now()-this.lastFind)/this.findTime),this.findCycle>=1){this.find=!1,this.findCycle=0,this.lastFire=Date.now();var i={type:"produce",object:new Z(this.pos)};return i.object.target=this.findTarget,i}return{type:"none"}}},{key:"collision",value:function(e){if(z({type:"sphere",pos:this.pos,r:.35*E},e))return"missileBase";if(!this.find&&z({type:"sphere",pos:this.pos,r:2.5*E},e)){var t={up:1.5,down:.5,left:1,right:0},i=e.pos.sub(this.pos).radian(),a=(t[this.detail.direction]+2*this.rotateCycle-this.range*this.unfoldCycle)*Math.PI%(2*Math.PI),o=(t[this.detail.direction]+2*this.rotateCycle+this.range*this.unfoldCycle)*Math.PI%(2*Math.PI);if(o<a&&(o+=2*Math.PI,i<Math.PI&&(i+=2*Math.PI)),i>=a&&i<=o)return"missileRay"}return"none"}},{key:"fire",value:function(e){this.find=!0,this.findTarget=e,this.lastFind=Date.now()}},{key:"draw",value:function(e){e.save(),e.translate(this.pos.x,this.pos.y),e.globalAlpha=this.perspective?.8:1,e.beginPath();var t=.7*E/(1+Math.sqrt(2));e.moveTo(-.5*t,-(.5+Math.sqrt(.5))*t),e.lineTo(.5*t,-(.5+Math.sqrt(.5))*t),e.lineTo((.5+Math.sqrt(.5))*t,-.5*t),e.lineTo((.5+Math.sqrt(.5))*t,.5*t),e.lineTo(.5*t,(.5+Math.sqrt(.5))*t),e.lineTo(-.5*t,(.5+Math.sqrt(.5))*t),e.lineTo(-(.5+Math.sqrt(.5))*t,.5*t),e.lineTo(-(.5+Math.sqrt(.5))*t,-.5*t),e.lineTo(-.5*t,-(.5+Math.sqrt(.5))*t);var i=e.createRadialGradient(-.1*E,-.1*E,1,0,0,.35*E);if(i.addColorStop(0,"white"),i.addColorStop(1,"#AAAAFF"),e.fillStyle=i,e.fill(),e.strokeStyle="#7D7DFF",e.stroke(),e.closePath(),e.globalAlpha*=.6,e.beginPath(),e.arc(0,0,.1*E,0,2*Math.PI),(i=e.createRadialGradient(0,0,0,0,0,.1*E)).addColorStop(0,"white"),i.addColorStop(.4,"#FF2D2D"),i.addColorStop(1,"#FF2D2D"),e.fillStyle=i,e.fill(),e.strokeStyle="#FF2D2D",e.stroke(),e.closePath(),this.active)if((i=e.createRadialGradient(0,0,0,0,0,this.r*E)).addColorStop(0,"white"),i.addColorStop(.6,"#FF5151"),i.addColorStop(1,"#FF0000"),this.find)e.globalAlpha*=6*this.findCycle%1*.4,e.beginPath(),e.arc(0,0,this.r*E,0,2*Math.PI),e.fillStyle=i,e.fill(),e.closePath();else{e.beginPath();var a={up:1.5,down:.5,left:1,right:0};e.arc(0,0,this.r*E,(a[this.detail.direction]+2*this.rotateCycle-this.range*this.unfoldCycle)*Math.PI,(a[this.detail.direction]+2*this.rotateCycle+this.range*this.unfoldCycle)*Math.PI),e.lineTo(0,0),e.fillStyle=i,e.fill(),e.closePath()}e.restore()}},{key:"place",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.active=!0,this.lastFire=Date.now(),this.gridPos=this.pos.sub(I.mapStart).toGrid(E);var i=this.gridPos;if(I.typeLayerPairs[e[i.y][i.x].type].isOverlap(this.layer))return!1;if(e[i.y][i.x].layer.isOverlap(this.layer))return!1;if(e[i.y][i.x].layer.add(this.layer),e[i.y][i.x].layer.status[2])for(var a=0;a<t.length;a++)if(t[a].gridPos.equal(i)&&2===t[a].layer.top()){t[a].loadable&&(t[a].loadObject={id:this.id,object:this});break}return!0}},{key:"remove",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.active=!1;var i=this.gridPos;if(e[i.y][i.x].layer.sub(this.layer),e[i.y][i.x].layer.status[2])for(var a=0;a<t.length;a++)if(t[a].gridPos.equal(i)&&2===t[a].layer.top()){t[a].loadable&&(t[a].loadObject=null);break}}}]),e}(),Z=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new M(0,0);Object(C.a)(this,e),this.type="missile",this.id=L(),this.pos=t,this.gridPos=new M(-1,-1),this.detail={name:"\u8ffd\u8e64\u5c0e\u5f48"},this.loadable=!1,this.perspective=!1,this.target=null,this.dirVec=new M(0,0),this.speed=2,this.lastRecord=Date.now(),this.layer=new R(3)}return Object(D.a)(e,[{key:"clone",value:function(){var t=new e;return t.unpackage(this.enpackage()),t}},{key:"setPerspective",value:function(e){this.perspective=e}},{key:"update",value:function(e,t){if(!this.pos.between(I.mapStart,I.mapStart.add(I.mapSize.mul(E))))return{type:"destory"};for(var i=0;i<e.length;i++)if(e[i].id!==this.id&&e[i].collision){var a=e[i].collision({type:"sphere",pos:this.pos,r:.1});if("ice"===a)this.speed*=1.01;else if("portal"===a)this.pos=e[i].teleport(e);else{if("arrow"===a)return{type:"destory"};if("cymbalWave"===a)return{type:"destory"};if("missile"===a)return{type:"destory"};if("block"===a)return{type:"destory"};if("lockedWall"===a)return{type:"destory"};if("woodenBox"===a)return e[i].push(e,t,this.pos),{type:"destory"};"magneticField"===a&&(this.pos=this.pos.add(e[i].getDisplacement()))}}return this.dirVec=this.target.pos.sub(this.pos).unit(),this.pos=this.pos.add(this.dirVec.mul(this.speed*E*(Date.now()-this.lastRecord)/1e3)),this.lastRecord=Date.now(),{type:"none"}}},{key:"collision",value:function(e){return z({type:"sphere",pos:this.pos,r:.2*E},e)?"missile":"none"}},{key:"draw",value:function(e){e.save(),e.translate(this.pos.x,this.pos.y),e.globalAlpha=this.perspective?.9:1,e.rotate(this.dirVec.radian()+.5*Math.PI);for(var t=0;t<2;t++){var i=0===t?-1:1;e.beginPath(),e.moveTo(.164*E*i,.2*E),e.lineTo(.3*E*i,.3*E),e.lineTo(.3*E*i,.45*E),e.lineTo(.128*E*i,.4*E),e.fillStyle="#F0F0F0",e.fill(),e.strokeStyle="#C0C0C0",e.stroke(),e.closePath()}e.beginPath(),e.moveTo(-.1*E,.5*E),e.lineTo(-.14*E,.64*E+.06*E*Math.random()),e.lineTo(-.03*E,.56*E),e.lineTo(0*E,.6*E+.06*E*Math.random()),e.lineTo(.03*E,.56*E),e.lineTo(.14*E,.64*E+.06*E*Math.random()),e.lineTo(.1*E,.5*E),e.fillStyle="#FF9224",e.fill(),e.lineWidth=.3,e.strokeStyle="#FF0000",e.stroke(),e.closePath(),e.lineWidth=1,e.beginPath(),e.arc(0,0,.2*E,0,Math.PI,!0),e.lineTo(-.11*E,.5*E),e.lineTo(.11*E,.5*E),e.lineTo(.2*E,0),e.fillStyle="#F0F0F0",e.fill(),e.strokeStyle="#C0C0C0",e.stroke(),e.closePath(),e.beginPath(),e.moveTo(-.195*E,0),e.lineTo(.195*E,0),e.strokeStyle="red",e.stroke(),e.closePath(),e.beginPath(),e.moveTo(-.186*E,.05*E),e.lineTo(.186*E,.05*E),e.strokeStyle="red",e.stroke(),e.closePath(),e.restore()}}]),e}(),$=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new M(0,0);Object(C.a)(this,e),this.type="lockedWall",this.id=L(),this.pos=t,this.gridPos=this.pos.sub(I.mapStart).toGrid(E),this.detail={name:"\u4e0a\u9396\u7684\u7246",direction:"horizontal"},this.loadable=!1,this.perspective=!1,this.locked=!0,this.index=-1,this.layer=new R(2,3)}return Object(D.a)(e,[{key:"clone",value:function(){var t=new e;return t.unpackage(this.enpackage()),t}},{key:"setPerspective",value:function(e){this.perspective=e}},{key:"detailFunction",value:function(){return{name:{type:"text"},direction:{type:"select",options:["horizontal","vertical"]}}}},{key:"enpackage",value:function(){return{type:this.type,id:this.id,gridPos:{x:this.gridPos.x,y:this.gridPos.y},name:this.detail.name,direction:this.detail.direction,index:this.index}}},{key:"unpackage",value:function(e){this.type=e.type,this.id=e.id,this.gridPos=new M(e.gridPos.x,e.gridPos.y),this.pos=this.gridPos.mul(E).add(I.mapStart).add(new M(.5*E,.5*E)),this.detail.name=e.name,this.detail.direction=e.direction,this.index=e.index,this.perspective=!0}},{key:"collision",value:function(e){var t={horizontal:new M(E,.4*E),vertical:new M(.4*E,E)};return this.locked&&z({type:"cube",pos:this.pos,size:t[this.detail.direction]},e)?"lockedWall":"none"}},{key:"draw",value:function(e){this.locked&&(e.save(),e.translate(this.pos.x,this.pos.y),e.globalAlpha=this.perspective?.6:1,"vertical"===this.detail.direction&&e.rotate(.5*Math.PI),e.beginPath(),e.rect(-.5*E,-.1*E,E,.2*E),e.fillStyle="#9D9D9D",e.fill(),e.strokeStyle="black",e.stroke(),e.closePath(),e.globalAlpha=1,e.beginPath(),e.arc(0,0,.2*E,0,2*Math.PI),e.fillStyle=this.index>=0?B[this.index]:"white",e.fill(),e.strokeStyle="black",e.stroke(),e.beginPath(),e.arc(0,-.06*E,.08*E,.375*Math.PI,.625*Math.PI,!0),e.lineTo(-.04*E,.13*E),e.lineTo(.04*E,.13*E),e.fillStyle="black",e.fill(),e.closePath(),e.restore())}},{key:"place",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(-1===this.index){for(var i=[0,0,0,0,0,0,0,0],a=0;a<t.length;a++)"unlocker"===t[a].type&&(i[t[a].index]=Math.max(1,i[t[a].index])),"lockedWall"===t[a].type&&(i[t[a].index]=2);for(var o=0;o<i.length;o++)if(1===i[o]){this.index=o;break}if(-1===this.index)for(var s=0;s<i.length;s++)if(0===i[s]){this.index=s;break}}if(-1===this.index)return!1;this.gridPos=this.pos.sub(I.mapStart).toGrid(E);var n=this.gridPos;return!I.typeLayerPairs[e[n.y][n.x].type].isOverlap(this.layer)&&(!e[n.y][n.x].layer.isOverlap(this.layer)&&(e[n.y][n.x].layer.add(this.layer),!0))}},{key:"remove",value:function(e){var t=this.gridPos;e[t.y][t.x].layer.sub(this.layer)}}]),e}(),ee=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new M(0,0);Object(C.a)(this,e),this.type="unlocker",this.id=L(),this.pos=t,this.gridPos=this.pos.sub(I.mapStart).toGrid(E),this.detail={name:"\u9470\u5319"},this.loadable=!1,this.perspective=!1,this.used=!1,this.index=-1,this.layer=new R(4)}return Object(D.a)(e,[{key:"clone",value:function(){var t=new e;return t.unpackage(this.enpackage()),t}},{key:"setPerspective",value:function(e){this.perspective=e}},{key:"detailFunction",value:function(){return{name:{type:"text"}}}},{key:"enpackage",value:function(){return{type:this.type,id:this.id,gridPos:{x:this.gridPos.x,y:this.gridPos.y},name:this.detail.name,index:this.index}}},{key:"unpackage",value:function(e){this.type=e.type,this.id=e.id,this.gridPos=new M(e.gridPos.x,e.gridPos.y),this.pos=this.gridPos.mul(E).add(I.mapStart).add(new M(.5*E,.5*E)),this.detail.name=e.name,this.index=e.index,this.perspective=!0}},{key:"collision",value:function(e){return!this.used&&z({type:"sphere",pos:this.pos,r:.35*E},e)?"unlocker":"none"}},{key:"unlock",value:function(e){for(var t=0;t<e.length;t++)"lockedWall"===e[t].type&&e[t].index===this.index&&(e[t].locked=!1,this.used=!0)}},{key:"draw",value:function(e){if(!this.used){e.save(),e.translate(this.pos.x,this.pos.y),e.globalAlpha=this.perspective?.8:1,e.rotate(.25*Math.PI),e.beginPath(),e.arc(0,-.25*E,.2*E,.4*Math.PI,.6*Math.PI,!0),e.lineTo(-.06*E,.4*E),e.lineTo(.06*E,.45*E),e.lineTo(.06*E,.38*E),e.lineTo(.15*E,.38*E),e.lineTo(.15*E,.34*E),e.lineTo(.06*E,.34*E),e.lineTo(.06*E,.3*E),e.lineTo(.18*E,.3*E),e.lineTo(.18*E,.24*E),e.lineTo(.06*E,.24*E);var t=e.createRadialGradient(0,-.35*E,0,0,0,.5*E);t.addColorStop(0,"white"),t.addColorStop(.3,this.index>=0?B[this.index]:"black"),t.addColorStop(1,this.index>=0?B[this.index]:"black"),e.fillStyle=t,e.fill(),e.closePath(),e.restore()}}},{key:"place",value:function(e,t){if(-1===this.index){for(var i=[0,0,0,0,0,0,0,0],a=0;a<t.length;a++)"lockedWall"===t[a].type&&(i[t[a].index]=Math.max(1,i[t[a].index])),"unlocker"===t[a].type&&(i[t[a].index]=2);for(var o=0;o<i.length;o++)if(1===i[o]){this.index=o;break}if(-1===this.index)for(var s=0;s<i.length;s++)if(0===i[s]){this.index=s;break}}if(-1===this.index)return!1;this.gridPos=this.pos.sub(I.mapStart).toGrid(E);var n=this.gridPos;return!I.typeLayerPairs[e[n.y][n.x].type].isOverlap(this.layer)&&(!e[n.y][n.x].layer.isOverlap(this.layer)&&(e[n.y][n.x].layer.add(this.layer),!0))}},{key:"remove",value:function(e,t){var i=this.gridPos;e[i.y][i.x].layer.sub(this.layer)}}]),e}(),te=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new M(0,0);Object(C.a)(this,e),this.type="block",this.id=L(),this.pos=t,this.gridPos=this.pos.sub(I.mapStart).toGrid(E),this.detail={name:"\u65b9\u584a"},this.loadable=!1,this.perspective=!1,this.layer=new R(3)}return Object(D.a)(e,[{key:"clone",value:function(){var t=new e;return t.unpackage(this.enpackage()),t}},{key:"setPerspective",value:function(e){this.perspective=e}},{key:"detailFunction",value:function(){return{name:{type:"text"}}}},{key:"enpackage",value:function(){return{type:this.type,id:this.id,gridPos:{x:this.gridPos.x,y:this.gridPos.y},name:this.detail.name}}},{key:"unpackage",value:function(e){this.type=e.type,this.id=e.id,this.gridPos=new M(e.gridPos.x,e.gridPos.y),this.pos=this.gridPos.mul(E).add(I.mapStart).add(new M(.5*E,.5*E)),this.detail.name=e.name,this.perspective=!0}},{key:"collision",value:function(e){return z({type:"cube",pos:this.pos,size:new M(E,E)},e)?"block":"none"}},{key:"draw",value:function(e){e.save(),e.translate(this.pos.x,this.pos.y),e.globalAlpha=this.perspective?.4:1,e.beginPath(),e.moveTo(-.5*E,-.5*E),e.lineTo(.5*E,-.5*E),e.lineTo(.5*E,.5*E),e.lineTo(-.5*E,.5*E),e.lineTo(-.5*E,-.5*E),e.fillStyle="#7B7B7B",e.fill(),e.strokeStyle="black",e.stroke(),e.closePath(),e.beginPath(),e.rect(-.5*E,-.5*E,E,E),e.fillStyle="#9D9D9D",e.fill(),e.strokeStyle="black",e.stroke(),e.closePath(),e.restore()}},{key:"place",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.gridPos=this.pos.sub(I.mapStart).toGrid(E);var i=this.gridPos;if(I.typeLayerPairs[e[i.y][i.x].type].isOverlap(this.layer))return!1;if(e[i.y][i.x].layer.isOverlap(this.layer))return!1;if(e[i.y][i.x].layer.add(this.layer),e[i.y][i.x].layer.status[2])for(var a=0;a<t.length;a++)if(t[a].gridPos.equal(i)&&2===t[a].layer.top()){t[a].loadable&&(t[a].loadObject={id:this.id,object:this});break}return!0}},{key:"remove",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=this.gridPos;if(e[i.y][i.x].layer.sub(this.layer),e[i.y][i.x].layer.status[2])for(var a=0;a<t.length;a++)if(t[a].gridPos.equal(i)&&2===t[a].layer.top()){t[a].loadable&&(t[a].loadObject=null);break}}}]),e}(),ie=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new M(0,0);Object(C.a)(this,e),this.type="movingPlatform_oblique",this.id=L(),this.pos=t,this.gridPos=this.pos.sub(I.mapStart).toGrid(E),this.detail={name:"\u79fb\u52d5\u5e73\u53f0(\u659c\u5411)",direction:"right-up",distance:1,speed:"normal"},this.loadable=!0,this.loadObject=null,this.lastRecord=Date.now(),this.active=!1,this.perspective=!1,this.layer=new R(0,1)}return Object(D.a)(e,[{key:"clone",value:function(){var t=new e;return t.unpackage(this.enpackage()),t}},{key:"setPerspective",value:function(e){this.perspective=e}},{key:"detailFunction",value:function(){return{name:{type:"text"},distance:{type:"int",min:1,max:15},direction:{type:"select",options:["right-up","right-down","left-up","left-down"]},speed:{type:"select",options:["super slow","slow","normal","fast","super fast"]}}}},{key:"enpackage",value:function(){return{type:this.type,id:this.id,gridPos:{x:this.gridPos.x,y:this.gridPos.y},name:this.detail.name,direction:this.detail.direction,distance:this.detail.distance,speed:this.detail.speed}}},{key:"unpackage",value:function(e){this.type=e.type,this.id=e.id,this.gridPos=new M(e.gridPos.x,e.gridPos.y),this.pos=this.gridPos.mul(E).add(I.mapStart).add(new M(.5*E,.5*E)),this.detail.name=e.name,this.detail.direction=e.direction,this.detail.distance=e.distance,this.detail.speed=e.speed,this.perspective=!0}},{key:"update",value:function(e,t){var i={"super slow":5600,slow:2800,normal:1400,fast:700,"super fast":280},a=M.direction(this.detail.direction).mul(this.detail.distance*E*Math.sqrt(2)),o=this.gridPos.mul(E).add(I.mapStart).add(new M(.5*E,.5*E));return~~((Date.now()-this.lastRecord)/i[this.detail.speed]/this.detail.distance)%2===0?this.pos=o.add(a.mul((Date.now()-this.lastRecord)/i[this.detail.speed]/this.detail.distance%1)):this.pos=o.add(a.mul(1-(Date.now()-this.lastRecord)/i[this.detail.speed]/this.detail.distance%1)),this.loadObject&&(this.loadObject.object.pos=this.pos),{type:"none"}}},{key:"collision",value:function(e){return z({type:"cube",pos:this.pos,size:new M(.7*E,.7*E)},e)?"movingPlatform":"none"}},{key:"draw",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;e.save();var i=this.gridPos.mul(E).add(I.mapStart).add(new M(.5*E,.5*E));if(this.active?e.translate(i.x,i.y):e.translate(this.pos.x,this.pos.y),e.globalAlpha=this.perspective?.8:1,-1===t||0===t){e.save();var a=M.direction(this.detail.direction).mul(this.detail.distance*E*Math.sqrt(2));e.beginPath(),e.rect(-.1*E,-.1*E,.2*E,.2*E),e.fillStyle="#4F4F4F",e.fill(),e.closePath(),e.beginPath(),e.moveTo(0,0),e.lineTo(a.x,a.y),e.strokeStyle="#4F4F4F",e.stroke(),e.closePath(),e.save(),e.translate(a.x,a.y),e.beginPath(),e.rect(-.1*E,-.1*E,.2*E,.2*E),e.fillStyle="#4F4F4F",e.fill(),e.closePath(),e.restore(),e.restore()}if(-1===t||1===t){if(this.active){var o=this.pos.sub(i);e.translate(o.x,o.y)}e.beginPath(),e.moveTo(0,-.45*E),e.arcTo(.45*E,-.45*E,.45*E,.45*E,.1*E),e.arcTo(.45*E,.45*E,-.45*E,.45*E,.1*E),e.arcTo(-.45*E,.45*E,-.45*E,-.45*E,.1*E),e.arcTo(-.45*E,-.45*E,.45*E,-.45*E,.1*E),e.lineTo(0,-.45*E),e.fillStyle="#ead48b",e.fill(),e.strokeStyle="#cb934d",e.stroke(),e.closePath(),e.beginPath(),e.moveTo(0,-.35*E),e.arcTo(.35*E,-.35*E,.35*E,.35*E,.1*E),e.arcTo(.35*E,.35*E,-.35*E,.35*E,.1*E),e.arcTo(-.35*E,.35*E,-.35*E,-.35*E,.1*E),e.arcTo(-.35*E,-.35*E,.35*E,-.35*E,.1*E),e.lineTo(0,-.35*E),e.strokeStyle="#f4f788",e.stroke(),e.closePath()}e.restore()}},{key:"place",value:function(e,t){this.active=!0,this.lastRecord=Date.now(),this.gridPos=this.pos.sub(I.mapStart).toGrid(E);var i=this.gridPos;if(I.typeLayerPairs[e[i.y][i.x].type].isOverlap(this.layer))return!1;if(e[i.y][i.x].layer.isOverlap(this.layer))return!1;if(e[i.y][i.x].layer.add(this.layer),e[i.y][i.x].layer.status[2])for(var a=0;a<t.length;a++)if(t[a].gridPos.equal(i)&&2===t[a].layer.top()){this.loadObject={id:t[a].id,object:t[a]};break}return!0}},{key:"remove",value:function(e){this.active=!1;var t=this.gridPos;e[t.y][t.x].layer.sub(this.layer)}}]),e}(),ae=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new M(0,0);Object(C.a)(this,e),this.type="movingPlatform_rect",this.id=L(),this.pos=t,this.gridPos=this.pos.sub(I.mapStart).toGrid(E),this.detail={name:"\u79fb\u52d5\u5e73\u53f0(\u77e9\u5f62)",clock:"clockwise",width:1,height:1,speed:"normal"},this.loadable=!0,this.loadObject=null,this.lastRecord=Date.now(),this.active=!1,this.perspective=!1,this.layer=new R(0,1)}return Object(D.a)(e,[{key:"clone",value:function(){var t=new e;return t.unpackage(this.enpackage()),t}},{key:"setPerspective",value:function(e){this.perspective=e}},{key:"detailFunction",value:function(){return{name:{type:"text"},clock:{type:"select",options:["clockwise","counterclockwise"]},width:{type:"int",min:1,max:15},height:{type:"int",min:1,max:15},speed:{type:"select",options:["super slow","slow","normal","fast","super fast"]}}}},{key:"enpackage",value:function(){return{type:this.type,id:this.id,gridPos:{x:this.gridPos.x,y:this.gridPos.y},name:this.detail.name,clock:this.detail.clock,width:this.detail.width,height:this.detail.height,speed:this.detail.speed}}},{key:"unpackage",value:function(e){this.type=e.type,this.id=e.id,this.gridPos=new M(e.gridPos.x,e.gridPos.y),this.pos=this.gridPos.mul(E).add(I.mapStart).add(new M(.5*E,.5*E)),this.detail.name=e.name,this.detail.start=e.start,this.detail.width=e.width,this.detail.height=e.height,this.detail.speed=e.speed,this.perspective=!0}},{key:"update",value:function(e,t){var i=this.gridPos.mul(E).add(I.mapStart).add(new M(.5*E,.5*E)),a=2*this.detail.width+2*this.detail.height,o="clockwise"===this.detail.clockwise?[0,this.detail.height/a,(this.detail.height+this.detail.width)/a,(2*this.detail.height+this.detail.width)/a]:[0,this.detail.width/a,(this.detail.height+this.detail.width)/a,(this.detail.height+2*this.detail.width)/a],s="clockwise"===this.detail.clockwise?[i,i.add(new M(0,-this.detail.height*E)),i.add(new M(this.detail.width*E,-this.detail.height*E)),i.add(new M(this.detail.width*E,0))]:[i,i.add(new M(this.detail.width*E,0)),i.add(new M(this.detail.width*E,-this.detail.height*E)),i.add(new M(0,-this.detail.height*E))],n=(Date.now()-this.lastRecord)/{"super slow":4e3,slow:2e3,normal:1e3,fast:500,"super fast":200}[this.detail.speed]/a%1;return this.pos=n>=o[0]&&n<o[1]?s[0].add(s[1].sub(s[0]).mul((n-o[0])/(o[1]-o[0]))):n>=o[1]&&n<o[2]?s[1].add(s[2].sub(s[1]).mul((n-o[1])/(o[2]-o[1]))):n>=o[2]&&n<o[3]?s[2].add(s[3].sub(s[2]).mul((n-o[2])/(o[3]-o[2]))):s[3].add(s[0].sub(s[3]).mul((n-o[3])/(1-o[3]))),this.loadObject&&(this.loadObject.object.pos=this.pos),{type:"none"}}},{key:"collision",value:function(e){return z({type:"cube",pos:this.pos,size:new M(.7*E,.7*E)},e)?"movingPlatform":"none"}},{key:"draw",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;e.save();var i=this.gridPos.mul(E).add(I.mapStart).add(new M(.5*E,.5*E));if(this.active?e.translate(i.x,i.y):e.translate(this.pos.x,this.pos.y),e.globalAlpha=this.perspective?.8:1,-1!==t&&0!==t||(e.save(),e.beginPath(),e.rect(0,-this.detail.height*E,this.detail.width*E,this.detail.height*E),e.lineWidth=1,e.strokeStyle="#4F4F4F",e.stroke(),e.closePath(),e.beginPath(),e.rect(-.1*E,-.1*E,.2*E,.2*E),e.fillStyle="#4F4F4F",e.fill(),e.closePath(),e.beginPath(),e.rect(-.1*E,-.1*E-this.detail.height*E,.2*E,.2*E),e.fillStyle="#4F4F4F",e.fill(),e.closePath(),e.beginPath(),e.rect(-.1*E+this.detail.width*E,-.1*E-this.detail.height*E,.2*E,.2*E),e.fillStyle="#4F4F4F",e.fill(),e.closePath(),e.beginPath(),e.rect(-.1*E+this.detail.width*E,-.1*E,.2*E,.2*E),e.fillStyle="#4F4F4F",e.fill(),e.closePath(),e.restore()),-1===t||1===t){if(this.active){var a=this.pos.sub(i);e.translate(a.x,a.y)}e.beginPath(),e.moveTo(0,-.45*E),e.arcTo(.45*E,-.45*E,.45*E,.45*E,.1*E),e.arcTo(.45*E,.45*E,-.45*E,.45*E,.1*E),e.arcTo(-.45*E,.45*E,-.45*E,-.45*E,.1*E),e.arcTo(-.45*E,-.45*E,.45*E,-.45*E,.1*E),e.lineTo(0,-.45*E),e.fillStyle="#ead48b",e.fill(),e.strokeStyle="#cb934d",e.stroke(),e.closePath(),e.beginPath(),e.moveTo(0,-.35*E),e.arcTo(.35*E,-.35*E,.35*E,.35*E,.1*E),e.arcTo(.35*E,.35*E,-.35*E,.35*E,.1*E),e.arcTo(-.35*E,.35*E,-.35*E,-.35*E,.1*E),e.arcTo(-.35*E,-.35*E,.35*E,-.35*E,.1*E),e.lineTo(0,-.35*E),e.strokeStyle="#f4f788",e.stroke(),e.closePath()}e.restore()}},{key:"place",value:function(e,t){this.active=!0,this.lastRecord=Date.now(),this.gridPos=this.pos.sub(I.mapStart).toGrid(E);var i=this.gridPos;if(I.typeLayerPairs[e[i.y][i.x].type].isOverlap(this.layer))return!1;if(e[i.y][i.x].layer.isOverlap(this.layer))return!1;if(e[i.y][i.x].layer.add(this.layer),e[i.y][i.x].layer.status[2])for(var a=0;a<t.length;a++)if(t[a].gridPos.equal(i)&&2===t[a].layer.top()){this.loadObject={id:t[a].id,object:t[a]};break}return!0}},{key:"remove",value:function(e){this.active=!1;var t=this.gridPos;e[t.y][t.x].layer.sub(this.layer)}}]),e}(),oe=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new M(0,0);Object(C.a)(this,e),this.type="woodenBox",this.id=L(),this.pos=t,this.gridPos=this.pos.sub(I.mapStart).toGrid(E),this.detail={name:"\u6728\u7bb1"},this.loadable=!1,this.perspective=!1,this.moveTo="none",this.moveTime=500,this.moveCycle=0,this.lastRecord=0,this.layer=new R(3)}return Object(D.a)(e,[{key:"clone",value:function(){var t=new e;return t.unpackage(this.enpackage()),t}},{key:"setPerspective",value:function(e){this.perspective=e}},{key:"detailFunction",value:function(){return{name:{type:"text"}}}},{key:"enpackage",value:function(){return{type:this.type,id:this.id,gridPos:{x:this.gridPos.x,y:this.gridPos.y},name:this.detail.name}}},{key:"unpackage",value:function(e){this.type=e.type,this.id=e.id,this.gridPos=new M(e.gridPos.x,e.gridPos.y),this.pos=this.gridPos.mul(E).add(I.mapStart).add(new M(.5*E,.5*E)),this.detail.name=e.name,this.perspective=!0}},{key:"update",value:function(e,t){if("none"!==this.moveTo){var i=(Date.now()-this.lastRecord)/this.moveTime;this.moveCycle+=i,this.lastRecord=Date.now(),this.pos=this.pos.add(M.direction(this.moveTo).mul(E*i)),this.moveCycle>=1&&(this.moveTo="none",this.pos=this.pos.sub(I.mapStart).toGrid(E).mul(E).add(I.mapStart).add(new M(.5*E,.5*E)))}else{this.pos.sub(I.mapStart).toGrid(E);for(var a=0;a<e.length;a++)if(e[a].id!==this.id&&e[a].collision){var o=e[a].collision({type:"sphere",pos:this.pos,r:.1});if("brokenPlatform"===o&&e[a].break(),"conveyor"===o){this.pos=e[a].pos.clone(),this.push(e,t,this.pos.sub(M.direction(e[a].detail.direction)));break}if("magneticField"===o){this.push(e,t,this.pos.sub(e[a].getDisplacement()));break}"mucus"!==o||e[a].loadObject||(e[a].loadObject={id:this.id,object:this},t[this.gridPos.y][this.gridPos.x].layer.status[3]=!1)}}return{type:"none"}}},{key:"collision",value:function(e){return z({type:"cube",pos:this.pos,size:new M(E,E)},e)?"woodenBox":"none"}},{key:"push",value:function(e,t,i){if("none"===this.moveTo){var a=this.pos.sub(I.mapStart).toGrid(E),o=i.sub(this.pos).radian();if(o>=.25*Math.PI&&o<.75*Math.PI){if(0===a.y||"block"===t[a.y-1][a.x].type)return;for(var s=0;s<e.length;s++){if(e[s].pos.sub(I.mapStart).toGrid(E).equal(new M(a.x,a.y-1))&&e[s].layer.status[3])return}this.moveTo="up"}else if(o>=1.75*Math.PI||o<.25*Math.PI){if(0===a.x||"block"===t[a.y][a.x-1].type)return;for(var n=0;n<e.length;n++){if(e[n].pos.sub(I.mapStart).toGrid(E).equal(new M(a.x-1,a.y))&&e[n].layer.status[3])return}this.moveTo="left"}else if(o>=1.25*Math.PI&&o<1.75*Math.PI){if(a.y===I.mapSize.y-1||"block"===t[a.y+1][a.x].type)return;for(var r=0;r<e.length;r++){if(e[r].pos.sub(I.mapStart).toGrid(E).equal(new M(a.x,a.y+1))&&e[r].layer.status[3])return}this.moveTo="down"}else{if(a.x===I.mapSize.x-1||"block"===t[a.y][a.x+1].type)return;for(var l=0;l<e.length;l++){if(e[l].pos.sub(I.mapStart).toGrid(E).equal(new M(a.x+1,a.y))&&e[l].layer.status[3])return}this.moveTo="right"}t[this.gridPos.y][this.gridPos.x].layer.status[3]=!1;for(var c=0;c<e.length;c++)"mucus"===e[c].type&&e[c].loadObject&&e[c].loadObject.id===this.id&&(e[c].loadObject=null,this.pos=this.pos.sub(I.mapStart).toGrid(E).mul(E).add(I.mapStart).add(new M(.5*E,.5*E)));this.moveCycle=0,this.lastRecord=Date.now()}}},{key:"draw",value:function(e){e.save(),e.translate(this.pos.x,this.pos.y),e.globalAlpha=this.perspective?.7:1,e.lineWidth=1,e.beginPath(),e.rect(-.45*E,-.4*E,.9*E,.8*E),e.fillStyle="#e4b95e",e.fill(),e.closePath(),e.beginPath(),e.rect(-.5*E,-.5*E,E,.1*E),e.fillStyle="#dab25d",e.fill(),e.strokeStyle="#806938",e.stroke(),e.closePath(),e.beginPath(),e.rect(-.5*E,.4*E,E,.1*E),e.fillStyle="#dab25d",e.fill(),e.strokeStyle="#806938",e.stroke(),e.closePath();for(var t=0;t<7;t++)e.beginPath(),e.moveTo((.15*t-.45)*E,-.4*E),e.lineTo((.15*t-.45)*E,.4*E),e.strokeStyle="#806938",e.stroke(),e.closePath();e.restore()}},{key:"place",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.gridPos=this.pos.sub(I.mapStart).toGrid(E);var i=this.gridPos;if(I.typeLayerPairs[e[i.y][i.x].type].isOverlap(this.layer))return!1;if(e[i.y][i.x].layer.isOverlap(this.layer))return!1;if(e[i.y][i.x].layer.add(this.layer),e[i.y][i.x].layer.status[2])for(var a=0;a<t.length;a++)if(t[a].gridPos.equal(i)&&2===t[a].layer.top()){t[a].loadable&&(t[a].loadObject={id:this.id,object:this});break}return!0}},{key:"remove",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=this.gridPos;e[i.y][i.x].layer.sub(this.layer);for(var a=0;a<t.length;a++)if(2===t[a].layer.top()&&t[a].loadObject&&t[a].loadObject.id===this.id){t[a].loadObject=null;break}}}]),e}(),se=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new M(0,0);Object(C.a)(this,e),this.type="magnet",this.id=L(),this.pos=t,this.gridPos=this.pos.sub(I.mapStart).toGrid(E),this.detail={name:"\u78c1\u9435",direction:"up",magneticField:"attraction",distance:3},this.loadable=!1,this.active=!1,this.perspective=!1,this.lastRecord=0,this.moveCycle=-1,this.layer=new R(4)}return Object(D.a)(e,[{key:"clone",value:function(){var t=new e;return t.unpackage(this.enpackage()),t}},{key:"setPerspective",value:function(e){this.perspective=e}},{key:"detailFunction",value:function(){return{name:{type:"text"},direction:{type:"select",options:["up","down","left","right"]},magneticField:{type:"select",options:["attraction","repulsion"]},distance:{type:"int",min:1,max:15}}}},{key:"enpackage",value:function(){return{type:this.type,id:this.id,gridPos:{x:this.gridPos.x,y:this.gridPos.y},name:this.detail.name,direction:this.detail.direction,magneticField:this.detail.magneticField,distance:this.detail.distance}}},{key:"unpackage",value:function(e){this.type=e.type,this.id=e.id,this.gridPos=new M(e.gridPos.x,e.gridPos.y),this.pos=this.gridPos.mul(E).add(I.mapStart).add(new M(.5*E,.5*E)),this.detail.name=e.name,this.detail.direction=e.direction,this.detail.magneticField=e.magneticField,this.detail.distance=e.distance,this.perspective=!0}},{key:"update",value:function(e,t){return Date.now()-this.lastRecord>1e3&&(this.lastRecord=Date.now()),this.moveCycle=(Date.now()-this.lastRecord)/1e3,{type:"none"}}},{key:"collision",value:function(e){var t=M.direction(this.detail.direction).mul(E*this.detail.distance/2),i="up"===this.detail.direction||"down"===this.detail.direction?new M(E,this.detail.distance*E+.5*E):new M(this.detail.distance*E+.5*E,E);return z({type:"cube",pos:this.pos.add(t),size:i},e)?"magneticField":"none"}},{key:"getDisplacement",value:function(){return M.direction(this.detail.direction).mul("attraction"===this.detail.magneticField?-1:1).mul(.01*E)}},{key:"draw",value:function(e){e.save(),e.translate(this.pos.x,this.pos.y),e.globalAlpha=this.perspective?.8:1;var t=this.detail.direction;e.rotate("up"===t?0:"down"===t?Math.PI:"left"===t?1.5*Math.PI:.5*Math.PI),e.beginPath(),e.moveTo(.4*E,-.4*E),e.arc(0,0,.4*E,0,Math.PI),e.lineTo(-.4*E,-.4*E),e.lineTo(-.2*E,-.4*E),e.lineTo(-.2*E,0),e.arc(0,0,.2*E,Math.PI,0,!0),e.lineTo(.2*E,-.4*E),e.lineTo(.4*E,-.4*E),e.fillStyle="#43315e",e.fill(),e.closePath(),e.beginPath(),e.rect(-.38*E,-.4*E,.16*E,.3*E),e.fillStyle="red",e.fill(),e.closePath(),e.textAlign="center",e.textBaseline="middle",e.font="5px italic",e.fillStyle="white",e.fillText("N",-.3*E,-.25*E),e.beginPath(),e.rect(.22*E,-.4*E,.16*E,.3*E),e.fillStyle="blue",e.fill(),e.closePath(),e.textAlign="center",e.textBaseline="middle",e.font="6px italic",e.fillStyle="white",e.fillText("S",.3*E,-.25*E),e.beginPath(),e.moveTo(.4*E,-.4*E),e.arc(0,0,.4*E,0,Math.PI),e.lineTo(-.4*E,-.4*E),e.lineTo(-.2*E,-.4*E),e.lineTo(-.2*E,0),e.arc(0,0,.2*E,Math.PI,0,!0),e.lineTo(.2*E,-.4*E),e.lineTo(.4*E,-.4*E),e.strokeStyle="black",e.stroke(),e.closePath(),this.active&&this.moveCycle>=0&&(e.beginPath(),e.rect(-.5*E,-.5*E-E*this.detail.distance,E,E*this.detail.distance),e.clip(),e.closePath(),e.globalAlpha=.3,e.translate(0,E*this.moveCycle*("repulsion"==this.detail.magneticField?-1:1)),e.beginPath(),e.moveTo(-.3*E,.5*E),e.lineTo(-.3*E,.5*E-E*this.detail.distance-2*E),e.setLineDash([.5,0,5]),e.strokeStyle="gray",e.stroke(),e.closePath(),e.beginPath(),e.moveTo(0,.5*E),e.lineTo(0,.5*E-E*this.detail.distance-2*E),e.setLineDash([.5,0,5]),e.strokeStyle="gray",e.stroke(),e.closePath(),e.beginPath(),e.moveTo(.3*E,.5*E),e.lineTo(.3*E,.5*E-E*this.detail.distance-2*E),e.setLineDash([.5,0,5]),e.strokeStyle="gray",e.stroke(),e.closePath()),e.restore()}},{key:"place",value:function(e){this.active=!0,this.moveCycle=-1,this.lastRecord=Date.now(),this.gridPos=this.pos.sub(I.mapStart).toGrid(E);var t=this.gridPos;return!I.typeLayerPairs[e[t.y][t.x].type].isOverlap(this.layer)&&(!e[t.y][t.x].layer.isOverlap(this.layer)&&(e[t.y][t.x].layer.add(this.layer),this.lastRecord=Date.now(),!0))}},{key:"remove",value:function(e){this.active=!1;var t=this.gridPos;e[t.y][t.x].layer.sub(this.layer)}}]),e}(),ne=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new M(0,0);Object(C.a)(this,e),this.type="brokenPlatform",this.id=L(),this.pos=t,this.gridPos=this.pos.sub(I.mapStart).toGrid(E),this.detail={name:"\u7834\u788e\u5e73\u53f0"},this.loadable=!1,this.perspective=!1,this.lastRecord=0,this.stage=0,this.count=0,this.stageCount=64,this.layer=new R(1,2)}return Object(D.a)(e,[{key:"clone",value:function(){var t=new e;return t.unpackage(this.enpackage()),t}},{key:"setPerspective",value:function(e){this.perspective=e}},{key:"detailFunction",value:function(){return{name:{type:"text"}}}},{key:"enpackage",value:function(){return{type:this.type,id:this.id,gridPos:{x:this.gridPos.x,y:this.gridPos.y},name:this.detail.name}}},{key:"unpackage",value:function(e){this.type=e.type,this.id=e.id,this.gridPos=new M(e.gridPos.x,e.gridPos.y),this.pos=this.gridPos.mul(E).add(I.mapStart).add(new M(.5*E,.5*E)),this.detail.name=e.name,this.perspective=!0}},{key:"update",value:function(e,t){return this.count>=this.stageCount&&this.stage<4&&(this.count=0,this.stage+=1),{type:"none"}}},{key:"collision",value:function(e){return this.stage<4&&z({type:"cube",pos:this.pos,size:new M(.99*E,.99*E)},e)?"brokenPlatform":"none"}},{key:"break",value:function(){this.count+=1}},{key:"draw",value:function(e){4!==this.stage&&(e.save(),e.translate(this.pos.x,this.pos.y),e.globalAlpha=this.perspective?.8:1,e.beginPath(),e.moveTo(0,-.45*E),e.arcTo(.45*E,-.45*E,.45*E,.45*E,.1*E),e.arcTo(.45*E,.45*E,-.45*E,.45*E,.1*E),e.arcTo(-.45*E,.45*E,-.45*E,-.45*E,.1*E),e.arcTo(-.45*E,-.45*E,.45*E,-.45*E,.1*E),e.lineTo(0,-.45*E),e.fillStyle="#D0D0D0",e.fill(),e.strokeStyle="#ADADAD",e.stroke(),e.closePath(),e.beginPath(),e.moveTo(0,-.35*E),e.arcTo(.35*E,-.35*E,.35*E,.35*E,.1*E),e.arcTo(.35*E,.35*E,-.35*E,.35*E,.1*E),e.arcTo(-.35*E,.35*E,-.35*E,-.35*E,.1*E),e.arcTo(-.35*E,-.35*E,.35*E,-.35*E,.1*E),e.lineTo(0,-.35*E),e.strokeStyle="#F0F0F0",e.stroke(),e.closePath(),this.stage>=0&&(e.save(),e.strokeStyle="#ADADAD",e.globalAlpha*=this.stage>0?1:this.count/this.stageCount,e.beginPath(),e.moveTo(.1*E,-.45*E),e.lineTo(.05*E,-.35*E),e.lineTo(.15*E,-.25*E),e.stroke(),e.closePath(),e.beginPath(),e.moveTo(-.45*E,.15*E),e.lineTo(-.35*E,-.05*E),e.lineTo(-.25*E,.05*E),e.lineTo(-.15*E,-.15*E),e.stroke(),e.closePath(),e.beginPath(),e.moveTo(.15*E,.45*E),e.lineTo(.25*E,.4*E),e.lineTo(.2*E,.3*E),e.lineTo(.35*E,.1*E),e.stroke(),e.closePath(),e.restore()),this.stage>=1&&(e.save(),e.strokeStyle="#ADADAD",e.globalAlpha*=this.stage>1?1:this.count/this.stageCount,e.beginPath(),e.moveTo(-.15*E,.45*E),e.lineTo(0*E,.35*E),e.lineTo(-.1*E,.25*E),e.stroke(),e.closePath(),e.beginPath(),e.moveTo(.45*E,-.3*E),e.lineTo(.35*E,-.2*E),e.lineTo(.3*E,-.05*E),e.lineTo(.1*E,-.15*E),e.lineTo(-.1*E,.05*E),e.stroke(),e.closePath(),e.beginPath(),e.moveTo(-.35*E,-.45*E),e.lineTo(-.2*E,-.3*E),e.stroke(),e.closePath(),e.restore()),this.stage>=2&&(e.save(),e.strokeStyle="#ADADAD",e.globalAlpha*=this.stage>2?1:this.count/this.stageCount,e.beginPath(),e.moveTo(-.45*E,.37*E),e.lineTo(-.36*E,.3*E),e.lineTo(-.23*E,.35*E),e.lineTo(-.01*E,.09*E),e.lineTo(.23*E,.21*E),e.stroke(),e.closePath(),e.beginPath(),e.moveTo(-.45*E,.21*E),e.lineTo(-.2*E,.16*E),e.lineTo(-.02*E,-.02*E),e.stroke(),e.closePath(),e.beginPath(),e.moveTo(-.05*E,-.45*E),e.lineTo(-.18*E,-.36*E),e.lineTo(.03*E,-.28*E),e.lineTo(-.28*E,-.16*E),e.lineTo(-.38*E,-.25*E),e.stroke(),e.closePath(),e.beginPath(),e.moveTo(.34*E,-.45*E),e.lineTo(.27*E,-.32*E),e.lineTo(.3*E,-.09*E),e.stroke(),e.closePath(),e.beginPath(),e.moveTo(.45*E,.31*E),e.lineTo(.4*E,.14*E),e.lineTo(.3*E,.22*E),e.stroke(),e.closePath(),e.beginPath(),e.moveTo(.45*E,.01*E),e.lineTo(.2*E,.03*E),e.stroke(),e.closePath(),e.restore()),e.restore())}},{key:"place",value:function(e){this.gridPos=this.pos.sub(I.mapStart).toGrid(E);var t=this.gridPos;return!I.typeLayerPairs[e[t.y][t.x].type].isOverlap(this.layer)&&(!e[t.y][t.x].layer.isOverlap(this.layer)&&(e[t.y][t.x].layer.add(this.layer),!0))}},{key:"remove",value:function(e){var t=this.gridPos;e[t.y][t.x].layer.sub(this.layer)}}]),e}(),re=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new M(0,0);Object(C.a)(this,e),this.type="deathTotem",this.id=L(),this.pos=t,this.gridPos=this.pos.sub(I.mapStart).toGrid(E),this.detail={name:"\u6b7b\u4ea1\u5716\u9a30"},this.loadable=!1,this.perspective=!1,this.layer=new R(2)}return Object(D.a)(e,[{key:"clone",value:function(){var t=new e;return t.unpackage(this.enpackage()),t}},{key:"setPerspective",value:function(e){this.perspective=e}},{key:"detailFunction",value:function(){return{name:{type:"text"}}}},{key:"enpackage",value:function(){return{type:this.type,id:this.id,gridPos:{x:this.gridPos.x,y:this.gridPos.y},name:this.detail.name}}},{key:"unpackage",value:function(e){this.type=e.type,this.id=e.id,this.gridPos=new M(e.gridPos.x,e.gridPos.y),this.pos=this.gridPos.mul(E).add(I.mapStart).add(new M(.5*E,.5*E)),this.detail.name=e.name,this.perspective=!0}},{key:"collision",value:function(e){return z({type:"cube",pos:this.pos,size:new M(.7*E,.7*E)},e)?"deathTotem":"none"}},{key:"draw",value:function(e){e.save(),e.translate(this.pos.x,this.pos.y),e.globalAlpha=this.perspective?.8:1,e.beginPath(),e.moveTo(0,-.35*E),e.arcTo(.35*E,-.35*E,.35*E,.35*E,.1*E),e.arcTo(.35*E,.35*E,-.35*E,.35*E,.1*E),e.arcTo(-.35*E,.35*E,-.35*E,-.35*E,.1*E),e.arcTo(-.35*E,-.35*E,.35*E,-.35*E,.1*E),e.lineTo(0,-.35*E);var t=e.createRadialGradient(0,0,0,0,0,.45*E);t.addColorStop(0,"#E800E8"),t.addColorStop(1,"#5E005E"),e.fillStyle=t,e.fill(),e.strokeStyle="#460046",e.stroke(),e.closePath(),e.globalAlpha=1,e.scale(.8,.8),e.beginPath(),e.arc(0,0,.25*E,.25*Math.PI,.75*Math.PI,!0),e.lineTo(-.1*E,.3*E),e.lineTo(.1*E,.3*E);var i=e.createRadialGradient(0,0,0,0,0,.2*E);i.addColorStop(0,"white"),i.addColorStop(1,"#E0E0E0"),e.fillStyle=i,e.fill(),e.closePath();for(var a=0;a<3;a++)e.beginPath(),e.moveTo(-.08*E+.08*a*E,.31*E),e.lineTo(-.08*E+.08*a*E,.24*E),e.strokeStyle=t,e.stroke(),e.closePath();for(var o=0;o<2;o++)e.beginPath(),e.arc(-.1*E,-.01*E,.08*E,.16*Math.PI,1.16*Math.PI),e.fillStyle=t,e.fill(),e.closePath(),e.beginPath(),e.moveTo(-.02*E,.1*E),e.lineTo(-.045*E,.16*E),e.strokeStyle=t,e.stroke(),e.closePath(),e.scale(-1,1);e.restore()}},{key:"place",value:function(e,t){this.gridPos=this.pos.sub(I.mapStart).toGrid(E);var i=this.gridPos;if(I.typeLayerPairs[e[i.y][i.x].type].isOverlap(this.layer))return!1;if(e[i.y][i.x].layer.isOverlap(this.layer))return!1;if(e[i.y][i.x].layer.add(this.layer),e[i.y][i.x].layer.status[1])for(var a=0;a<t.length;a++)if(t[a].gridPos.equal(i)&&1===t[a].layer.top()){t[a].loadable&&(t[a].loadObject={id:this.id,object:this});break}return!0}},{key:"remove",value:function(e,t){var i=this.gridPos;if(e[i.y][i.x].layer.sub(this.layer),e[i.y][i.x].layer.status[1])for(var a=0;a<t.length;a++)if(t[a].gridPos.equal(i)&&1===t[a].layer.top()){t[a].loadable&&(t[a].loadObject=null);break}}}]),e}();function le(e){for(var t={map:[],objects:[]},i=0;i<I.mapSize.y;i++){for(var a=[],o=0;o<I.mapSize.x;o++)a[o]={type:e.map[i][o].type};t.map[i]=a}for(var s=0,n=0;n<e.objects.length;n++)e.objects[n].enpackage&&(t.objects[s++]=e.objects[n].enpackage());return t}function ce(e){for(var t={map:[],objects:[]},i=0;i<I.mapSize.y;i++){for(var a=[],o=0;o<I.mapSize.x;o++)a[o]={type:e.map[i][o].type,layer:new R};t.map[i]=a}for(var s=0;s<e.objects.length;s++){switch(e.objects[s].type){case"spikedBlock":t.objects[s]=new G;break;case"platform":t.objects[s]=new N;break;case"movingPlatform":t.objects[s]=new W;break;case"bow":t.objects[s]=new q;break;case"mucus":t.objects[s]=new X;break;case"cymbal":t.objects[s]=new _;break;case"ice":t.objects[s]=new H;break;case"conveyor":t.objects[s]=new V;break;case"portal":t.objects[s]=new K;break;case"trapPlatform":t.objects[s]=new Q;break;case"missileBase":t.objects[s]=new J;break;case"lockedWall":t.objects[s]=new $;break;case"unlocker":t.objects[s]=new ee;break;case"block":t.objects[s]=new te;break;case"movingPlatform_oblique":t.objects[s]=new ie;break;case"movingPlatform_rect":t.objects[s]=new ae;break;case"woodenBox":t.objects[s]=new oe;break;case"magnet":t.objects[s]=new se;break;case"brokenPlatform":t.objects[s]=new ne;break;case"deathTotem":t.objects[s]=new re}t.objects[s].unpackage(e.objects[s]),t.objects[s].place(t.map,t.objects)}return t}function he(e){return Object(P.jsx)(P.Fragment,{children:Object(P.jsx)("h1",{children:"Loading"})})}var de=i(262),pe=i(80),ye=i.n(pe),ue=i(120),be=i.n(ue),fe=i(270),ve=i(272),ge=i(271),me=i(261),ke=i(265),je=i(263),xe=i(59),we=i(264),Pe=(i(260),i(291)),Oe=i(5),Se=i(83),Te=i(197),Fe=i(266),Ce=i(269),De=i(267),Me=i(268);function Ae(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:0},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{x:e.canvas.width,y:e.canvas.height};e.clearRect(t.x,t.y,i.x,i.y)}function Re(e,t){for(var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=I.mapSize,o=I.gridWidth,s=I.blockColor,n=I.startColor,r=I.endColor,l=I.noneColor,c=I.deadColor,h=I.iceColor,d=I.muddyColor,p=I.boundaryColor,y=I.auxiliaryColor,u=function(e,i){return t[e.y][e.x].type.includes("block")&&t[i.y][i.x].type.includes("block")?"b_b":t[e.y][e.x].type.includes("block")||t[i.y][i.x].type.includes("block")?"n_b":"n_n"},b=0;b<a.y;b++)for(var f=0;f<a.x;f++)"block"!==t[b][f].type&&(e.save(),e.beginPath(),e.rect(f*o,b*o,o,o),e.fillStyle=t[b][f].type.includes("start")?n:t[b][f].type.includes("end")?r:t[b][f].type.includes("dead")?c:t[b][f].type.includes("ice")?h:t[b][f].type.includes("muddy")?d:l,e.fill(),e.closePath(),e.restore());if(!i){for(var v=1;v<a.y;v++)e.beginPath(),e.moveTo(0,v*o),e.lineTo(a.x*o,v*o),e.strokeStyle=y,e.stroke(),e.closePath();for(var g=0;g<a.x;g++)e.beginPath(),e.moveTo(g*o,0),e.lineTo(g*o,a.y*o),e.strokeStyle=y,e.stroke(),e.closePath()}for(var m=0;m<=a.y;m++)for(var k=0;k<=a.x;k++){if(e.save(),k>=0&&k<a.x&&m>=0&&m<a.y&&"block"===t[m][k].type&&(e.beginPath(),e.rect(k*o,m*o,o,o),e.fillStyle=s,e.fill(),e.closePath()),k!==a.x)if(m>0&&m<a.y){var j=u(new M(k,m-1),new M(k,m));"n_b"===j&&(e.beginPath(),e.moveTo(k*o,m*o),e.lineTo((k+1)*o,m*o),e.strokeStyle=p,e.stroke(),e.closePath())}else 0===m&&"block"!==t[m][k].type&&(e.beginPath(),e.moveTo(k*o,m*o),e.lineTo((k+1)*o,m*o),e.strokeStyle=p,e.stroke(),e.closePath()),m===a.y&&"block"!==t[m-1][k].type&&(e.beginPath(),e.moveTo(k*o,m*o),e.lineTo((k+1)*o,m*o),e.strokeStyle=p,e.stroke(),e.closePath());if(m!==a.y)if(k>0&&k<a.x){var x=u(new M(k-1,m),new M(k,m));"n_b"===x&&(e.beginPath(),e.moveTo(k*o,m*o),e.lineTo(k*o,(m+1)*o),e.strokeStyle=p,e.stroke(),e.closePath())}else 0===k&&"block"!==t[m][k].type&&(e.beginPath(),e.moveTo(k*o,m*o),e.lineTo(k*o,(m+1)*o),e.strokeStyle=p,e.stroke(),e.closePath()),k===a.x&&"block"!==t[m][k-1].type&&(e.beginPath(),e.moveTo(k*o,m*o),e.lineTo(k*o,(m+1)*o),e.strokeStyle=p,e.stroke(),e.closePath());e.restore()}}function Ie(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;e.save(),e.scale(t,t),e.beginPath(),e.moveTo(-.3,0),e.arcTo(-.3,-.5,.5,0,.1),e.arcTo(.5,0,-.3,.5,.1),e.arcTo(-.3,.5,-.3,0,.1),e.lineTo(-.3,0),e.fillStyle="green",e.fill(),e.closePath(),e.restore()}function Le(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;e.save(),e.scale(t,t),e.fillStyle="red",e.beginPath(),e.moveTo(-.35,0),e.arcTo(-.35,-.5,-.15,-.5,.1),e.arcTo(-.15,-.5,-.15,.5,.1),e.arcTo(-.15,.5,-.35,.5,.1),e.arcTo(-.35,.5,-.35,0,.1),e.lineTo(-.35,0),e.fill(),e.closePath(),e.beginPath(),e.moveTo(.35,0),e.arcTo(.35,-.5,.15,-.5,.1),e.arcTo(.15,-.5,.15,.5,.1),e.arcTo(.15,.5,.35,.5,.1),e.arcTo(.35,.5,.35,0,.1),e.lineTo(.35,0),e.fill(),e.closePath(),e.restore()}function Ee(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;e.save(),e.scale(t,t),e.lineWidth=.06,e.strokeStyle="gray";for(var i=0;i<3;i++)e.beginPath(),e.moveTo(.2*i-.2,0),e.lineTo(.2*i-.2,.4),e.stroke(),e.closePath();e.beginPath(),e.moveTo(-.4,-.2),e.arcTo(-.4,.6,.4,.6,.1),e.arcTo(.4,.6,.4,-.2,.1),e.lineTo(.4,-.2),e.stroke(),e.closePath(),e.beginPath(),e.moveTo(-.5,-.4),e.lineTo(.5,-.4),e.lineTo(.5,-.2),e.lineTo(-.5,-.2),e.lineTo(-.5,-.4),e.stroke(),e.closePath(),e.beginPath(),e.moveTo(-.2,-.4),e.lineTo(-.2,-.6),e.lineTo(.2,-.6),e.lineTo(.2,-.4),e.stroke(),e.closePath(),e.restore()}var ze=function(e){var t=Object(a.useRef)(),i=e.setting;return Object(a.useEffect)((function(){var e=t.current.getContext("2d");e.save(),e.scale(.1,.1),Re(e,i.map),e.restore(),e.save(),e.scale(.1,.1),e.translate(-I.mapStart.x,-I.mapStart.y);for(var a=0;a<I.maxLayer;a++)for(var o=0;o<i.objects.length;o++)i.objects[o].layer.status[a]&&i.objects[o].draw(e,a);e.restore()})),Object(P.jsx)("canvas",{ref:t,width:"102.4px",height:"51.2px"})},Be={map:[[{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"}],[{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"}],[{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"}],[{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"}],[{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"}],[{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"}],[{type:"block"},{type:"block"},{type:"start"},{type:"start"},{type:"start"},{type:"start"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"end"},{type:"end"},{type:"end"},{type:"end"},{type:"block"},{type:"block"}],[{type:"block"},{type:"block"},{type:"start"},{type:"start"},{type:"start"},{type:"start"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"end"},{type:"end"},{type:"end"},{type:"end"},{type:"block"},{type:"block"}],[{type:"block"},{type:"block"},{type:"start"},{type:"start"},{type:"start"},{type:"start"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"end"},{type:"end"},{type:"end"},{type:"end"},{type:"block"},{type:"block"}],[{type:"block"},{type:"block"},{type:"start"},{type:"start"},{type:"start"},{type:"start"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"end"},{type:"end"},{type:"end"},{type:"end"},{type:"block"},{type:"block"}],[{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"}],[{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"}],[{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"}],[{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"none"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"}],[{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"}],[{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"},{type:"block"}]],objects:[]};function Ge(e){return Object(P.jsx)(w.a,Object(p.a)({elevation:6,variant:"filled"},e))}var Ne=Object(Oe.a)((function(e){return{root:{color:e.palette.getContrastText(Se.a[100]),backgroundColor:Se.a[100],"&:hover":{backgroundColor:Se.a[100]}}}}))(f.a);var We=Object(g.a)((function(e){return{icon:{marginRight:e.spacing(2)},heroContent:{backgroundColor:e.palette.background.paper,padding:e.spacing(8,0,6)},heroButtons:{marginTop:e.spacing(4)},cardGrid:{paddingTop:e.spacing(8),paddingBottom:e.spacing(8)},card:{height:"100%",display:"flex",flexDirection:"column"},cardMedia:{paddingTop:"56.25%"},cardContent:{flexGrow:1},footer:{backgroundColor:e.palette.background.paper,padding:e.spacing(6)}}}));function qe(e){var t=We(),i=Object(y.f)(),s=e.data,n=s.uuid,r=s.name,l=Object(a.useState)(e.data.mapIDs),p=Object(d.a)(l,2),u=p[0],v=p[1],g=Object(a.useState)(!1),m=Object(d.a)(g,2),k=m[0],j=m[1],w=Object(a.useState)(""),O=Object(d.a)(w,2),S=O[0],T=O[1],F=Object(a.useState)("success"),C=Object(d.a)(F,2),D=C[0],M=C[1],A=Object(a.useState)([]),R=Object(d.a)(A,2),I=R[0],L=R[1],E=Object(a.useState)(""),z=Object(d.a)(E,2),B=z[0],G=z[1],N=Object(a.useState)(!1),W=Object(d.a)(N,2),q=W[0],Y=W[1],X=Object(a.useState)(!0),_=Object(d.a)(X,2),U=_[0],H=_[1],V=function(){var e=Object(h.a)(c.a.mark((function e(t){var i,a,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.post("/api/deleteSingleMap",{id:t,uuid:n});case 2:i=e.sent,a=i.data,o=a.success,a.errorCode,o?(T("Delete success"),M("success"),j(!0),Q()):(T("Delete Fail"),M("error"),j(!0));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),K=function(){var e=Object(h.a)(c.a.mark((function e(t){var i,a,o,s;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("getAllMaps"),e.next=3,b.post("/api/getAllMaps",{mapIDs:t});case 3:i=e.sent,a=i.data,o=a.success,a.errorCode,s=a.maps,o?L(s):console.log("FAIL");case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Q=function(){var e=Object(h.a)(c.a.mark((function e(){var t,i,a,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.post("/api/getUserData",{uuid:n});case 2:t=e.sent,i=t.data,a=i.success,o=i.mapIDs,a?(console.log(o),v(o),K(o)):console.log("getMapids fail"),H(!1);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),J=function(e){if(void 0===I[e])return"...";var t=I[e].statistic,i=t.fastestPass,a=t.fastestMan,o=t.passTime,s=t.playTime;return"fastestPass:".concat(i,", fastestMan:").concat(a,", passTime:").concat(o,", playTime:").concat(s)};return Object(a.useEffect)((function(){console.log("busy?".concat(U)),H(!0),Q()}),[]),Object(P.jsxs)(o.a.Fragment,{children:[Object(P.jsx)(me.a,{}),Object(P.jsx)(de.a,{position:"relative",children:Object(P.jsxs)(je.a,{children:[Object(P.jsx)(ye.a,{className:t.icon}),Object(P.jsx)(xe.a,{variant:"h6",color:"inherit",noWrap:!0,children:"Play Ground"})]})}),Object(P.jsxs)("main",{children:[Object(P.jsx)(x.a,{open:k,autoHideDuration:3e3,onClose:function(){j(!1)},children:Object(P.jsx)(Ge,{onClose:function(){j(!1)},severity:D,children:S})}),Object(P.jsx)("div",{className:t.heroContent,children:Object(P.jsxs)(we.a,{maxWidth:"sm",children:[Object(P.jsxs)(xe.a,{component:"h1",variant:"h2",align:"center",color:"textPrimary",gutterBottom:!0,children:["Hi ",r]}),Object(P.jsx)(xe.a,{variant:"h5",align:"center",color:"textSecondary",paragraph:!0,children:"\u4f60\u53ef\u4ee5\u5728\u9019\u908a\u8a2d\u8a08\u3001\u67e5\u770b\u4f60\u6240\u64c1\u6709\u7684\u95dc\u5361\uff01\uff01"}),Object(P.jsx)("div",{className:t.heroButtons,children:Object(P.jsxs)(ke.a,{container:!0,spacing:2,justify:"center",children:[Object(P.jsx)(ke.a,{item:!0,children:Object(P.jsx)(f.a,{variant:"contained",color:"secondary",onClick:function(){i.push("/")},children:"\u767b\u51fa"})}),Object(P.jsx)(ke.a,{item:!0,children:Object(P.jsx)(f.a,{variant:"contained",color:"primary",onClick:function(){i.push({pathname:"/PopularMap",state:{uuid:n,name:r,login:!0}})},children:"\u67e5\u770b\u71b1\u9580\u6392\u884c\u5730\u5716"})}),Object(P.jsx)(ke.a,{item:!0,children:Object(P.jsx)(f.a,{color:"secondary",variant:"outlined",onClick:function(){i.push({pathname:"/EditMode",state:{uuid:n,name:r,login:!0,id:0,title:"",description:""}})},children:"\u65b0\u5730\u5716"})}),Object(P.jsx)(ke.a,{item:!0,children:Object(P.jsx)(f.a,{color:"primary",variant:"outlined",onClick:Q,children:"\u91cd\u65b0\u6574\u7406"})})]})})]})}),Object(P.jsxs)(Fe.a,{open:q,onClose:function(){Y(!1)},"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[Object(P.jsx)(De.a,{children:Object(P.jsx)(Me.a,{id:"alert-dialog-description",children:"\u522a\u9664\u5730\u5716\uff1f\uff08\u7121\u6cd5\u5fa9\u539f\uff09"})}),Object(P.jsxs)(Ce.a,{children:[Object(P.jsx)(f.a,{onClick:function(){Y(!1)},color:"primary",children:"\u53d6\u6d88"}),Object(P.jsx)(f.a,{onClick:function(){V(B),Y(!1)},color:"primary",autoFocus:!0,children:"\u78ba\u8a8d"})]})]}),U?Object(P.jsx)(he,{}):Object(P.jsx)(we.a,{className:t.cardGrid,maxWidth:"md",children:Object(P.jsx)(ke.a,{container:!0,spacing:4,children:u.map((function(e,a){return Object(P.jsx)(ke.a,{item:!0,xs:12,sm:6,md:4,children:Object(P.jsxs)(fe.a,{className:t.card,children:[Object(P.jsx)(ze,{setting:ce(I[a]?I[a].content:Be)}),Object(P.jsxs)(ge.a,{className:t.cardContent,children:[Object(P.jsx)(xe.a,{gutterBottom:!0,variant:"h5",component:"h2",children:I[a]?I[a].title:""}),Object(P.jsx)(xe.a,{children:I[a]?I[a].description:""})]}),Object(P.jsxs)(ve.a,{children:[Object(P.jsx)(f.a,{size:"small",color:"primary",disabled:void 0===I[a],onClick:function(){i.push({pathname:"/PlayMode",state:{uuid:n,name:r,login:!0,id:e,mode:"test"}})},children:"Play"}),Object(P.jsx)(f.a,{size:"small",color:"primary",disabled:void 0===I[a]||void 0!==I[a]&&I[a].publish,onClick:function(){i.push({pathname:"/EditMode",state:{uuid:n,name:r,login:!0,id:e,title:I[a]?I[a].title:"",description:I[a]?I[a].description:""}})},children:"Edit"}),void 0===I[a]?Object(P.jsx)("p",{children:"???"}):I[a].publish?Object(P.jsx)(Pe.a,{title:J(a),children:Object(P.jsx)(f.a,{size:"small",color:"primary",variant:"text",children:"Statistic"})}):Object(P.jsx)(P.Fragment,{children:Object(P.jsx)(Ne,{size:"small",color:"primary",variant:"contained",children:"Private"})}),Object(P.jsx)(Te.a,{className:t.margin,size:"large",variant:"outlined",color:"secondary",onClick:function(){G(e),Y(!0)},children:Object(P.jsx)(be.a,{})})]})]})},e)}))})})]}),Object(P.jsx)("footer",{className:t.footer})]})}function Ye(e){return Object(P.jsx)(P.Fragment,{children:Object(P.jsx)("h1",{children:" ERROR QAQ "})})}function Xe(e){return void 0!==e.location.state&&!!e.location.state.login}var _e=function(e){return Object(P.jsx)(P.Fragment,{children:Xe(e)?Object(P.jsx)(qe,{data:e.location.state}):Object(P.jsx)(Ye,{})})},Ue=i(24),He=i(74),Ve=i(4),Ke=i(288),Qe=i(282),Je=i(256),Ze=i(278),$e=i(95),et=i(121),tt=i.n(et),it=i(122),at=i.n(it),ot=i(199),st=i(279),nt=i(280),rt=i(123),lt=i.n(rt),ct=i(124),ht=i.n(ct),dt=i(125),pt=i.n(dt),yt=i(126),ut=i.n(yt),bt=i(127),ft=i.n(bt),vt=i(64),gt=i.n(vt),mt=i(82),kt=i.n(mt),jt=i(273),xt=i(277),wt=i(276),Pt=i(274),Ot=i(275),St=i(292);function Tt(e){return Object(P.jsx)(w.a,Object(p.a)({elevation:6,variant:"filled"},e))}var Ft=Object(Oe.a)((function(e){return{root:{color:"#ffc107","&:hover":{backgroundColor:"#fff7b0"}}}}))(Te.a),Ct=Object(g.a)((function(e){return{seeMore:{marginTop:e.spacing(3)}}}));function Dt(e){var t=Object(y.f)(),i=Ct(),s=e.info,n=s.name,r=s.uuid,l=(s.login,Object(a.useState)(!1)),p=Object(d.a)(l,2),u=p[0],f=p[1],v=Object(a.useState)(""),g=Object(d.a)(v,2),k=g[0],j=g[1],w=Object(a.useState)(3),O=Object(d.a)(w,2),S=O[0],T=(O[1],Object(a.useState)(!1)),F=Object(d.a)(T,2),C=F[0],D=F[1],M=Object(a.useState)(""),A=Object(d.a)(M,2),R=A[0],I=A[1],L=Object(a.useState)("success"),E=Object(d.a)(L,2),z=E[0],B=E[1],G=function(){var e=Object(h.a)(c.a.mark((function e(t){var i,a,o,s;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("value:".concat(t)),e.next=3,b.post("/api/rateMap",{rateID:k,val:t,name:n});case 3:i=e.sent,a=i.data,o=a.success,s=a.errorCode,o?(I("Rate Success"),B("success"),D(!0)):1===s?(I("You need to pass this map to rate it"),B("error"),D(!0)):2===s?(I("You rated it before, the previous rate has been updated!"),B("info"),D(!0)):(I("Unknow error: ".concat(s)),B("error"),D(!0));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),N=function(e){var t=0,i=0;return e.forEach((function(e){t+=e.rate,i+=1})),[t,i,0===i?0:t/i]};return Object(P.jsxs)(o.a.Fragment,{children:[Object(P.jsx)(x.a,{open:C,autoHideDuration:3e3,onClose:function(){D(!1)},children:Object(P.jsx)(Tt,{onClose:function(){D(!1)},severity:z,children:R})}),Object(P.jsx)(m.a,{open:u,onClose:function(){f(!1)},children:Object(P.jsx)("div",{style:{backgroundColor:"white",position:"absolute",margin:"0",top:"50%",left:"30%",width:"40%",height:"50%",transform:"translateY(-50%)"},children:Object(P.jsxs)("div",{style:{marginTop:"1cm",top:"30%",left:"50%",position:"absolute",transform:"translate(-50%,-50%)",msTransform:"translate(-50%,-50%)"},children:[Object(P.jsx)(xe.a,{component:"legend",children:"Rate"}),Object(P.jsx)(St.a,{name:"simple-controlled",value:S,onChange:function(e,t){G(t),f(!1)}})]})})}),Object(P.jsxs)(jt.a,{size:"small",children:[Object(P.jsx)(Pt.a,{children:Object(P.jsxs)(Ot.a,{children:[Object(P.jsx)(wt.a,{}),Object(P.jsx)(wt.a,{children:"Author"}),Object(P.jsx)(wt.a,{children:"Title"}),Object(P.jsx)(wt.a,{children:"Description"}),Object(P.jsx)(wt.a,{children:"Number of Plays"}),Object(P.jsx)(wt.a,{children:"Number of Passes"}),Object(P.jsx)(wt.a,{children:"Fastest"}),Object(P.jsx)(wt.a,{align:"right",children:"Record holder"}),Object(P.jsx)(wt.a,{})]})}),Object(P.jsx)(xt.a,{children:e.data.map((function(e){return Object(P.jsxs)(Ot.a,{children:[Object(P.jsx)(Te.a,{className:i.margin,size:"large",variant:"outlined",color:"secondary",onClick:function(){t.push({pathname:"/PlayMode",state:{uuid:r,name:n,login:!0,id:e.id,mode:"challenge"}})},children:Object(P.jsx)(ye.a,{})}),Object(P.jsx)(wt.a,{children:e.author}),Object(P.jsx)(wt.a,{children:e.title}),Object(P.jsx)(wt.a,{children:e.description}),Object(P.jsx)(wt.a,{children:e.statistic.playTime}),Object(P.jsx)(wt.a,{children:e.statistic.passTime}),Object(P.jsx)(wt.a,{children:999.9===e.statistic.fastestPass?"-":e.statistic.fastestPass}),Object(P.jsx)(wt.a,{align:"right",children:"None"===e.statistic.fastestMan?"-":e.statistic.fastestMan}),"".concat(N(e.rateRec)[2].toFixed(2),"(").concat(N(e.rateRec)[1],")"),Object(P.jsx)(Ft,{className:i.margin,size:"large",variant:"outlined",color:"primary",onClick:function(){j(e.id),f(!0)},children:Object(P.jsx)(kt.a,{})})]})}))})]})]})}var Mt=Object(Oe.a)({root:{"& label.Mui-focused":{color:"black"},"& .MuiInput-underline:after":{borderBottomColor:"green"},"& .MuiOutlinedInput-root":{"& fieldset":{borderColor:"red",backgroundColor:"RoyalBlue"},"&:hover fieldset":{borderColor:"yellow"},"&.Mui-focused fieldset":{borderColor:"green",backgroundColor:"white",opacity:"0.1"}}}})(v.a);var At=Object(g.a)((function(e){return{root:{display:"flex"},toolbar:{paddingRight:24},toolbarIcon:Object(p.a)({display:"flex",alignItems:"center",justifyContent:"flex-end",padding:"0 8px"},e.mixins.toolbar),appBar:{zIndex:e.zIndex.drawer+1,transition:e.transitions.create(["width","margin"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen})},appBarShift:{marginLeft:240,width:"calc(100% - ".concat(240,"px)"),transition:e.transitions.create(["width","margin"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.enteringScreen})},menuButton:{marginRight:36},menuButtonHidden:{display:"none"},title:{flexGrow:1},drawerPaper:{position:"relative",whiteSpace:"nowrap",width:240,transition:e.transitions.create("width",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.enteringScreen})},drawerPaperClose:Object(He.a)({overflowX:"hidden",transition:e.transitions.create("width",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen}),width:e.spacing(7)},e.breakpoints.up("sm"),{width:e.spacing(9)}),appBarSpacer:e.mixins.toolbar,content:{flexGrow:1,height:"100vh",overflow:"auto"},container:{paddingTop:e.spacing(4),paddingBottom:e.spacing(4)},paper:{padding:e.spacing(2),display:"flex",overflow:"auto",flexDirection:"column"},fixedHeight:{height:240}}}));function Rt(e){var t=Object(y.f)(),i=At(),o=e.data,s=(o.name,o.uuid,o.login,Object(a.useState)(!0)),n=Object(d.a)(s,2),r=n[0],l=n[1],p=Object(a.useState)([]),u=Object(d.a)(p,2),f=u[0],v=u[1],g=Object(a.useState)([]),m=Object(d.a)(g,2),k=m[0],j=m[1],x=Object(a.useState)(!0),w=Object(d.a)(x,2),O=(w[0],w[1]),S=Object(a.useState)(""),T=Object(d.a)(S,2),F=T[0],C=T[1];Object(a.useEffect)((function(){O(!0),function(){var e=Object(h.a)(c.a.mark((function e(){var t,i,a,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.post("/api/getAllMapsByOrder",{});case 2:t=e.sent,i=t.data,a=i.success,o=i.maps,i.errorCode,a&&(console.log("setAllMaps"),j(o),v(o)),O(!1);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()()}),[]);var D=function(e){var t=0,i=0;return e.forEach((function(e){t+=e.rate,i+=1})),[t,i,0===i?0:t/i]};return Object(P.jsxs)("div",{className:i.root,children:[Object(P.jsx)(me.a,{}),Object(P.jsx)(de.a,{position:"absolute",className:Object(Ve.a)(i.appBar,r&&i.appBarShift),children:Object(P.jsxs)(je.a,{className:i.toolbar,children:[Object(P.jsx)(Te.a,{edge:"start",color:"inherit","aria-label":"open drawer",onClick:function(){l(!0)},className:Object(Ve.a)(i.menuButton,r&&i.menuButtonHidden),children:Object(P.jsx)(tt.a,{})}),Object(P.jsx)(xe.a,{component:"h1",variant:"h6",color:"inherit",noWrap:!0,className:i.title,children:"Other Maps"}),Object(P.jsx)(Mt,{className:i.margin,label:"Search Author",variant:"outlined",id:"custom-css-outlined-input",value:F,onChange:function(e){C(e.target.value.trim()),function(e){console.log("HandlerSearch");var t=Object(Ue.a)(f);t=t.filter((function(t){return t.author.toLowerCase().includes(e.toLowerCase())})),j(t)}(e.target.value.trim())}})]})}),Object(P.jsxs)(Ke.a,{variant:"permanent",classes:{paper:Object(Ve.a)(i.drawerPaper,!r&&i.drawerPaperClose)},open:r,children:[Object(P.jsx)("div",{className:i.toolbarIcon,children:Object(P.jsx)(Te.a,{onClick:function(){l(!1)},children:Object(P.jsx)(at.a,{})})}),Object(P.jsx)(Ze.a,{}),Object(P.jsx)(Je.a,{children:Object(P.jsxs)("div",{children:[Object(P.jsxs)(ot.a,{button:!0,onClick:function(){console.log("Handler1");var e=Object(Ue.a)(f);!function(e){for(var t,i=e.length;0!==i;){t=Math.floor(Math.random()*i),i--;var a=[e[t],e[i]];e[i]=a[0],e[t]=a[1]}}(e),j(e)},children:[Object(P.jsx)(st.a,{children:Object(P.jsx)(lt.a,{})}),Object(P.jsx)(nt.a,{primary:"All Maps"})]}),Object(P.jsxs)(ot.a,{button:!0,onClick:function(){console.log("Handler3");var e=Object(Ue.a)(f);e.sort((function(e,t){return D(t.rateRec)[2].toFixed(2)-D(e.rateRec)[2].toFixed(2)})),j(e)},children:[Object(P.jsx)(st.a,{children:Object(P.jsx)(kt.a,{})}),Object(P.jsx)(nt.a,{primary:"High Rate Maps"})]}),Object(P.jsxs)(ot.a,{button:!0,onClick:function(){console.log("Handler2");var e=Object(Ue.a)(f);e.sort((function(e,t){return t.statistic.playTime-e.statistic.playTime})),j(e)},children:[Object(P.jsx)(st.a,{children:Object(P.jsx)(ht.a,{})}),Object(P.jsx)(nt.a,{primary:"Most Plays"})]}),Object(P.jsxs)(ot.a,{button:!0,onClick:function(){console.log("Handler3");var e=Object(Ue.a)(f);e.sort((function(e,t){return t.statistic.passTime-e.statistic.passTime})),j(e)},children:[Object(P.jsx)(st.a,{children:Object(P.jsx)(pt.a,{})}),Object(P.jsx)(nt.a,{primary:"Most Passes"})]}),Object(P.jsxs)(ot.a,{button:!0,onClick:function(){console.log("Handler4"),j(f)},children:[Object(P.jsx)(st.a,{children:Object(P.jsx)(ut.a,{})}),Object(P.jsx)(nt.a,{primary:"Newest"})]}),Object(P.jsxs)(ot.a,{button:!0,onClick:function(){console.log("Handler5");var e=Object(Ue.a)(f);e=e.reverse(),j(e)},children:[Object(P.jsx)(st.a,{children:Object(P.jsx)(ft.a,{})}),Object(P.jsx)(nt.a,{primary:"Oldest"})]}),Object(P.jsxs)(ot.a,{button:!0,onClick:t.goBack,children:[Object(P.jsx)(st.a,{children:Object(P.jsx)(gt.a,{})}),Object(P.jsx)(nt.a,{primary:"Go Back"})]})]})})]}),Object(P.jsxs)("main",{className:i.content,children:[Object(P.jsx)("div",{className:i.appBarSpacer}),Object(P.jsxs)(we.a,{maxWidth:"lg",className:i.container,children:[Object(P.jsx)(ke.a,{container:!0,spacing:3,children:Object(P.jsx)(ke.a,{item:!0,xs:12,children:Object(P.jsx)($e.a,{className:i.paper,children:Object(P.jsx)(Dt,{data:k,info:e.data})})})}),Object(P.jsx)(Qe.a,{pt:4})]})]})]})}function It(e){return void 0!==e.location.state&&!!e.location.state.login}var Lt=function(e){return Object(P.jsx)(P.Fragment,{children:It(e)?Object(P.jsx)(Rt,{data:e.location.state}):Object(P.jsx)(Ye,{})})};var Et=function(e,t,i){var a=t.map,o=t.objects,s=I.gridWidth;if(Ae(e),e.save(),e.rect(I.mapStart.x,I.mapStart.y,I.mapSize.x*s,I.mapSize.y*s),e.clip(),e.save(),e.translate(I.mapStart.x,I.mapStart.y),Re(e,a),i.select){var n=M.leftUp(i.selectPair[0],i.selectPair[1]),r=M.rightDown(i.selectPair[0],i.selectPair[1]).sub(n).add(new M(1,1));e.save(),e.beginPath(),e.rect(n.x*s,n.y*s,r.x*s,r.y*s),e.setLineDash([.5,0,5]),e.strokeStyle="black",e.stroke(),e.closePath(),e.restore()}e.restore();for(var l=0;l<I.maxLayer;l++)for(var c=0;c<o.length;c++)o[c].layer.status[l]&&o[c].draw(e,l);e.restore(),e.save();var h=new M(64,64),d=[];d.push("class platform"),1===i.opt&&d.push.apply(d,Object(Ue.a)(I.editObjectList.platform)),d.push("class covering"),2===i.opt&&d.push.apply(d,Object(Ue.a)(I.editObjectList.covering)),d.push("class obstacle"),3===i.opt&&d.push.apply(d,Object(Ue.a)(I.editObjectList.obstacle)),d.push("class special"),4===i.opt&&d.push.apply(d,Object(Ue.a)(I.editObjectList.special)),e.translate(88,516);for(var p=0;p<16;p++){var y=null,u="default",b=void 0,f=void 0;if(d[p-1])switch(d[p-1]){case"class platform":if(u="class",1===i.opt){var v=new M(h.x*(p+.5),.5*h.y),g=e.createRadialGradient(v.x,v.y,0,v.x,v.y,1.5*s);g.addColorStop(0,I.editFrame.platform.fColor),g.addColorStop(1,"#B9B9FF"),b=g}else b="#B9B9FF";f="#9393FF";break;case"class covering":if(u="class",2===i.opt){var m=new M(h.x*(p+.5),.5*h.y),k=e.createRadialGradient(m.x,m.y,0,m.x,m.y,1.5*s);k.addColorStop(0,I.editFrame.covering.fColor),k.addColorStop(1,"#96FED1"),b=k}else b="#96FED1";f="#1AFD9C";break;case"class obstacle":if(u="class",3===i.opt){var j=new M(h.x*(p+.5),.5*h.y),x=e.createRadialGradient(j.x,j.y,0,j.x,j.y,1.5*s);x.addColorStop(0,I.editFrame.obstacle.fColor),x.addColorStop(1,"#FF9797"),b=x}else b="#FF9797";f="#FF5151";break;case"class special":if(u="class",4===i.opt){var w=new M(h.x*(p+.5),.5*h.y),P=e.createRadialGradient(w.x,w.y,0,w.x,w.y,1.5*s);P.addColorStop(0,I.editFrame.special.fColor),P.addColorStop(1,"#FFE66F"),b=P}else b="#FFE66F";f="#FFDC35";break;case"spikedBlock":y=new G(new M(h.x*(p+.5),.5*h.y)),u="obstacle";break;case"platform":y=new N(new M(h.x*(p+.5),.5*h.y)),u="platform";break;case"bow":y=new q(new M(h.x*(p+.5),.5*h.y+3)),u="obstacle";break;case"movingPlatform":y=new W(new M(h.x*(p+.5),.5*h.y+10)),u="platform";break;case"mucus":y=new X(new M(h.x*(p+.5),.5*h.y)),u="covering";break;case"cymbal":y=new _(new M(h.x*(p+.5),.5*h.y)),u="obstacle";break;case"ice":y=new H(new M(h.x*(p+.5),.5*h.y)),u="covering";break;case"conveyor":y=new V(new M(h.x*(p+.5),.5*h.y)),u="covering";break;case"portal":y=new K(new M(h.x*(p+.5),.5*h.y)),u="special";break;case"trapPlatform":y=new Q(new M(h.x*(p+.5),.5*h.y)),u="platform";break;case"missileBase":y=new J(new M(h.x*(p+.5),.5*h.y)),u="obstacle";break;case"lockedWall":y=new $(new M(h.x*(p+.5),.5*h.y)),u="special";break;case"unlocker":y=new ee(new M(h.x*(p+.5),.5*h.y)),u="special";break;case"block":y=new te(new M(h.x*(p+.5),.5*h.y)),u="obstacle";break;case"movingPlatform_oblique":y=new ie(new M(h.x*(p+.5)-10,.5*h.y+10)),u="platform";break;case"movingPlatform_rect":y=new ae(new M(h.x*(p+.5)-10,.5*h.y+10)),u="platform";break;case"woodenBox":y=new oe(new M(h.x*(p+.5),.5*h.y)),u="obstacle";break;case"magnet":y=new se(new M(h.x*(p+.5),.5*h.y)),u="special";break;case"brokenPlatform":y=new ne(new M(h.x*(p+.5),.5*h.y)),u="platform";break;case"deathTotem":y=new re(new M(h.x*(p+.5),.5*h.y)),u="covering"}if(e.beginPath(),e.rect(0+h.x*p+3,3,h.x-6,h.y-6),e.fillStyle="class"===u?b:I.editFrame[u].fColor,e.fill(),e.lineWidth=2,e.strokeStyle="class"===u?f:I.editFrame[u].sColor,e.stroke(),e.lineWidth=1,e.closePath(),0===p?(e.save(),e.translate(.5*h.x,.5*h.y),i.active?Le(e,s):Ie(e,s),e.restore()):15===p&&(e.save(),e.translate(15.5*h.x,.5*h.y),Ee(e,s),e.restore()),y&&y.draw(e),"class platform"===d[p-1])new Q(new M(h.x*(p+.5)-8,.5*h.y-8)).draw(e),new N(new M(h.x*(p+.5)+8,.5*h.y-0)).draw(e),e.textAlign="center",e.textBaseline="middle",e.font="15px italic",e.strokeStyle="white",e.lineWidth=2,e.strokeText("\u5e73\u53f0\u985e",h.x*(p+.5),.5*h.y+20),e.fillStyle="black",e.fillText("\u5e73\u53f0\u985e",h.x*(p+.5),.5*h.y+20);else if("class covering"===d[p-1]){new X(new M(h.x*(p+.5)-10,.5*h.y-10)).draw(e),new V(new M(h.x*(p+.5)+10,.5*h.y-5)).draw(e),new H(new M(h.x*(p+.5),.5*h.y+3)).draw(e),e.textAlign="center",e.textBaseline="middle",e.font="15px italic",e.strokeStyle="white",e.lineWidth=2,e.strokeText("\u8986\u84cb\u985e",h.x*(p+.5),.5*h.y+20),e.fillStyle="black",e.fillText("\u8986\u84cb\u985e",h.x*(p+.5),.5*h.y+20)}else if("class obstacle"===d[p-1]){var O=new G(new M(h.x*(p+.5)-3,.5*h.y-6));e.save(),e.translate(O.pos.x,O.pos.y),e.scale(.7,.7),e.translate(-O.pos.x,-O.pos.y),O.draw(e),e.restore();var S=new q(new M(h.x*(p+.5)-3,.5*h.y+12));e.save(),e.translate(O.pos.x,O.pos.y),e.rotate(-.36*Math.PI),e.translate(-O.pos.x,-O.pos.y),S.draw(e),e.restore(),e.textAlign="center",e.textBaseline="middle",e.font="15px italic",e.strokeStyle="white",e.lineWidth=2,e.strokeText("\u969c\u7919\u985e",h.x*(p+.5),.5*h.y+20),e.fillStyle="black",e.fillText("\u969c\u7919\u985e",h.x*(p+.5),.5*h.y+20)}else if("class special"===d[p-1]){var T=new K(new M(h.x*(p+.5)-2,.5*h.y-7));T.index=1,T.open=!0,T.draw(e),new ee(new M(h.x*(p+.5)+10,.5*h.y)).draw(e),e.textAlign="center",e.textBaseline="middle",e.font="15px  sans-serif",e.strokeStyle="white",e.strokeText("\u7279\u6b8a\u985e",h.x*(p+.5),.5*h.y+20),e.fillStyle="black",e.fillText("\u7279\u6b8a\u985e",h.x*(p+.5),.5*h.y+20)}}if(e.restore(),i.clear?(e.save(),e.translate(i.holdObject.pos.x,i.holdObject.pos.y),Ee(e,.5*s),e.restore()):(i.holding||i.hold)&&i.holdObject.draw(e),""!==i.message.text){e.save();var F=(Date.now()-i.message.lastPost)/3e3;F=F<.05?F/.05:F>.9?Math.max(1-F,0)/.1:1,e.globalAlpha=F,e.translate(I.mapStart.x,I.mapStart.y),e.globalAlpha*=.2,e.beginPath(),e.rect(I.mapSize.x*s*.3,0,I.mapSize.x*s*.4,s),e.fillStyle="white",e.fill(),e.closePath(),e.globalAlpha*=5,e.textAlign="center",e.textBaseline="middle",e.font="15px italic",e.lineWidth=2,e.fillStyle=i.message.color?i.message.color:"red",e.fillText(i.message.text,I.mapSize.x*s*.5,.5*s),e.restore()}};function zt(e,t){for(var i=0;i<I.maxLayer;i++)for(var a=0;a<e.length;a++)if(e[a].update){var o=e[a].update(e,t);switch(o.type){case"produce":e.push(o.object);break;case"destory":e.splice(a--,1)}}}var Bt=i(285),Gt=i(281),Nt=i(283),Wt=i(254),qt=i(290),Yt=i(293),Xt={name:"\u540d\u7a31",platform:"\u5e73\u53f0",movingPlatform:"\u79fb\u52d5\u5e73\u53f0(\u76f4\u884c)",movingPlatform_oblique:"\u79fb\u52d5\u5e73\u53f0(\u659c\u5411)",movingPlatform_rect:"\u79fb\u52d5\u5e73\u53f0(\u77e9\u5f62)",trapPlatform:"\u9677\u9631\u5e73\u53f0",mucus:"\u9ecf\u6db2",ice:"\u51b0\u5c64",conveyor:"\u50b3\u8f38\u5e36",block:"\u65b9\u584a",spikedBlock:"\u5c16\u523a\u65b9\u584a",bow:"\u5f13\u7bad\u5ea7",cymbal:"\u97f3\u9238",missileBase:"\u8ffd\u8e64\u5c0e\u5f48\u767c\u5c04\u53f0",portal:"\u50b3\u9001\u9580",lockedWall:"\u4e0a\u9396\u7684\u7246",unlocker:"\u9470\u5319",woodenBox:"\u6728\u7bb1",magnet:"\u78c1\u9435",brokenPlatform:"\u7834\u788e\u5e73\u53f0",deathTotem:"\u6b7b\u4ea1\u5716\u9a30",direction:"\u65b9\u5411",up:"\u4e0a",down:"\u4e0b",left:"\u5de6",right:"\u53f3","left-up":"\u5de6\u4e0a","left-down":"\u5de6\u4e0b","right-up":"\u53f3\u4e0a","right-down":"\u53f3\u4e0b",horizontal:"\u6c34\u5e73",vertical:"\u91cd\u76f4",speed:"\u901f\u5ea6","super slow":"\u8d85\u7d1a\u6162",slow:"\u6162",normal:"\u666e\u901a",fast:"\u5feb","super fast":"\u8d85\u7d1a\u5feb",clock:"\u65cb\u8f49\u65b9\u5411",clockwise:"\u9806\u6642\u9418",counterclockwise:"\u9006\u6642\u9418",duration:"\u9593\u9694",short:"\u77ed",long:"\u9577",RoF:"\u5c04\u901f",range:"\u7bc4\u570d",large:"\u5927",small:"\u5c0f",magneticField:"\u78c1\u5834",attraction:"\u5438\u5f15",repulsion:"\u6392\u65a5",distance:"\u8ddd\u96e2",width:"\u5bec",height:"\u9ad8",upSpike:"\u4e0a\u65b9\u6709\u523a",downSpike:"\u4e0b\u65b9\u6709\u523a",leftSpike:"\u5de6\u65b9\u6709\u523a",rightSpike:"\u53f3\u65b9\u6709\u523a",rotate:"\u65cb\u8f49"},_t=Object(g.a)((function(e){return{formControl:{margin:e.spacing(1),minWidth:120},selectEmpty:{marginTop:e.spacing(2)}}})),Ut=Object(a.forwardRef)((function(e,t){var i=Object(a.useRef)(),o=_t(),s=Object(a.useState)(1),n=Object(d.a)(s,2),r=(n[0],n[1],e.setting),l=Object(a.useState)({select:!1,selecting:!1,selectPair:[new M,new M],hold:!1,holding:!1,holdObject:null,holdDetail:{},clear:!1,active:!1,opt:0,message:{text:"",lastPost:0}}),c=Object(d.a)(l,2),h=c[0],y=c[1],u=function(){e.save(r)};Object(a.useImperativeHandle)(t,(function(){return{returnSetting:function(){e.save(r)}}})),Object(a.useEffect)((function(){var e,t,a=i.current,o=a.getContext("2d");e=function(e,t,i,a,o){var s=I.mapStart,n=I.mapStart.add(I.mapSize.mul(I.gridWidth)),r=I.gridWidth,l=function(e,t){return e.ctrlKey&&"portal"!==t.type&&"lockedWall"!==t.type&&"unlocker"!==t.type},c=function(e){var i=new M(e.offsetX,e.offsetY);if(!t.holding&&t.selecting&&i.between(s,n)){var a=i.sub(s).toGrid(r);t.selectPair[1]=a}else t.holding&&(i.between(s,n)&&!t.clear?t.holdObject.pos=i.sub(s).toGrid(r).mul(r).add(s.add(new M(.5*r,.5*r))):t.holdObject.pos=i.clone())},h=function(e){var c=new M(e.offsetX,e.offsetY);if(0===e.button)if(c.between(s,n))if(console.log(t.clear),t.clear){var h=c.sub(s).toGrid(r),d=a.map[h.y][h.x].layer.top();if(-1!==d)for(var y=0;y<a.objects.length;y++)a.objects[y].gridPos.equal(h)&&(e.ctrlKey||a.objects[y].layer.top()===d)&&(a.objects[y].remove(a.map,a.objects),a.objects.splice(y--,1))}else if(t.holding){t.holdObject.pos=c.sub(s).toGrid(r).mul(r).add(s.add(new M(.5*r,.5*r)));var u=Object(p.a)({},t);e.ctrlKey&&!l(e,t.holdObject)&&(u.message={text:"\u9019\u500b\u7269\u4ef6\u7121\u6cd5\u88ab\u8907\u88fd",lastPost:Date.now()}),u.holding=l(e,t.holdObject),t.holdObject.place(a.map,a.objects)?a.objects.push(t.holdObject):u.message={text:"\u9019\u500b\u683c\u5b50\u5df2\u7d93\u88ab\u5176\u4ed6\u540c\u7a2e\u7684\u7269\u4ef6\u4f54\u64da",lastPost:Date.now()},u.holdObject=l(e,t.holdObject)?t.holdObject.clone():null,i(u)}else{var b=Object(p.a)({},t),f=c.sub(s).toGrid(r),v=a.map[f.y][f.x].layer.top();if(-1!==v){for(var g=0;g<a.objects.length;g++)if(a.objects[g].gridPos.equal(f)&&a.objects[g].layer.top()===v){b.holding=!0,b.hold=!1,b.select=!1,b.selecting=!1,e.ctrlKey&&!l(e,a.objects[g])&&(b.message={text:"\u9019\u500b\u7269\u4ef6\u7121\u6cd5\u88ab\u8907\u88fd",lastPost:Date.now()}),l(e,a.objects[g])||a.objects[g].remove(a.map,a.objects),b.holdObject=l(e,a.objects[g])?a.objects[g].clone():a.objects[g],b.holdObject.pos=c.sub(s).toGrid(r).mul(r).add(s.add(new M(.5*r,.5*r))),b.holdDetail=a.objects[g].detailFunction(),l(e,a.objects[g])||a.objects.splice(g,1);break}}else b.select=!0,b.selecting=!0,b.selectPair=[f,f];i(b)}else{var m=Object(p.a)({},t);if(m.select=!1,m.selecting=!1,m.holding=!1,m.hold=!1,m.holdObject=null,m.clear=!1,i(m),c.between(new M(88,516),new M(1112,580))){var k=~~((e.offsetX-88)/64),j="";if(0===k)j="stoporplay";else if(15===k)j="clear";else{var x=[];x.push("class platform"),1===t.opt&&x.push.apply(x,Object(Ue.a)(I.editObjectList.platform)),x.push("class covering"),2===t.opt&&x.push.apply(x,Object(Ue.a)(I.editObjectList.covering)),x.push("class obstacle"),3===t.opt&&x.push.apply(x,Object(Ue.a)(I.editObjectList.obstacle)),x.push("class special"),4===t.opt&&x.push.apply(x,Object(Ue.a)(I.editObjectList.special)),j=x[k-1]?x[k-1]:""}var w=0;switch(j){case"stoporplay":m.clear=!1,m.active=!m.active,m.active&&(m.message={text:"\u5efa\u8b70\u5728\u975c\u6b62\u72c0\u614b\u4e0b\u7de8\u8f2f\u7269\u4ef6",lastPost:Date.now(),color:"green"}),o();break;case"clear":m.clear=!m.clear,m.clear&&(m.message={text:"\u6ce8\u610f\uff01\u4f60\u73fe\u5728\u8655\u65bc\u6e05\u9664\u7269\u4ef6\u7684\u72c0\u614b",lastPost:Date.now(),color:"green"},m.holding=!0,m.holdObject={type:"trashCan",pos:new M(e.offsetX,e.offsetY)},m.holdDetail={});break;case"class platform":m.opt=1===t.opt?0:1;break;case"class covering":m.opt=2===t.opt?0:2;break;case"class obstacle":m.opt=3===t.opt?0:3;break;case"class special":m.opt=4===t.opt?0:4;break;case"spikedBlock":m.holding=!0,m.holdObject=new G(new M(e.offsetX,e.offsetY)),m.holdDetail=m.holdObject.detailFunction(),m.holdObject.setPerspective(!0);break;case"platform":m.holding=!0,m.holdObject=new N(new M(e.offsetX,e.offsetY)),m.holdDetail=m.holdObject.detailFunction(),m.holdObject.setPerspective(!0);break;case"bow":m.holding=!0,m.holdObject=new q(new M(e.offsetX,e.offsetY)),m.holdDetail=m.holdObject.detailFunction(),m.holdObject.setPerspective(!0);break;case"movingPlatform":m.holding=!0,m.holdObject=new W(new M(e.offsetX,e.offsetY)),m.holdDetail=m.holdObject.detailFunction(),m.holdObject.setPerspective(!0);break;case"mucus":m.holding=!0,m.holdObject=new X(new M(e.offsetX,e.offsetY)),m.holdDetail=m.holdObject.detailFunction(),m.holdObject.setPerspective(!0);break;case"cymbal":m.holding=!0,m.holdObject=new _(new M(e.offsetX,e.offsetY)),m.holdDetail=m.holdObject.detailFunction(),m.holdObject.setPerspective(!0);break;case"ice":m.holding=!0,m.holdObject=new H(new M(e.offsetX,e.offsetY)),m.holdDetail=m.holdObject.detailFunction(),m.holdObject.setPerspective(!0);break;case"conveyor":m.holding=!0,m.holdObject=new V(new M(e.offsetX,e.offsetY)),m.holdDetail=m.holdObject.detailFunction(),m.holdObject.setPerspective(!0);break;case"portal":w=0;for(var P=0;P<a.objects.length;P++)"portal"===a.objects[P].type&&w++;w<16?(m.holding=!0,m.holdObject=new K(new M(e.offsetX,e.offsetY)),m.holdDetail=m.holdObject.detailFunction(),m.holdObject.setPerspective(!0)):(m.holding=!1,m.message={text:"\u50b3\u9001\u9580\u6700\u591a\u53ea\u80fd\u653e\u7f6e 16 \u500b",lastPost:Date.now()});break;case"trapPlatform":m.holding=!0,m.holdObject=new Q(new M(e.offsetX,e.offsetY)),m.holdDetail=m.holdObject.detailFunction(),m.holdObject.setPerspective(!0);break;case"missileBase":m.holding=!0,m.holdObject=new J(new M(e.offsetX,e.offsetY)),m.holdDetail=m.holdObject.detailFunction(),m.holdObject.setPerspective(!0);break;case"lockedWall":w=0;for(var O=0;O<a.objects.length;O++)"lockedWall"===a.objects[O].type&&w++;w<8?(m.holding=!0,m.holdObject=new $(new M(e.offsetX,e.offsetY)),m.holdDetail=m.holdObject.detailFunction(),m.holdObject.setPerspective(!0)):(m.holding=!1,m.message={text:"\u4e0a\u9396\u7684\u7246\u6700\u591a\u53ea\u80fd\u653e\u7f6e 8 \u500b",lastPost:Date.now()});break;case"unlocker":w=0;for(var S=0;S<a.objects.length;S++)"unlocker"===a.objects[S].type&&w++;w<8?(m.holding=!0,m.holdObject=new ee(new M(e.offsetX,e.offsetY)),m.holdDetail=m.holdObject.detailFunction(),m.holdObject.setPerspective(!0)):(m.holding=!1,m.message={text:"\u9470\u5319\u6700\u591a\u53ea\u80fd\u653e\u7f6e 8 \u500b",lastPost:Date.now()});break;case"block":m.holding=!0,m.holdObject=new te(new M(e.offsetX,e.offsetY)),m.holdDetail=m.holdObject.detailFunction(),m.holdObject.setPerspective(!0);break;case"movingPlatform_oblique":m.holding=!0,m.holdObject=new ie(new M(e.offsetX,e.offsetY)),m.holdDetail=m.holdObject.detailFunction(),m.holdObject.setPerspective(!0);break;case"movingPlatform_rect":m.holding=!0,m.holdObject=new ae(new M(e.offsetX,e.offsetY)),m.holdDetail=m.holdObject.detailFunction(),m.holdObject.setPerspective(!0);break;case"woodenBox":m.holding=!0,m.holdObject=new oe(new M(e.offsetX,e.offsetY)),m.holdDetail=m.holdObject.detailFunction(),m.holdObject.setPerspective(!0);break;case"magnet":m.holding=!0,m.holdObject=new se(new M(e.offsetX,e.offsetY)),m.holdDetail=m.holdObject.detailFunction(),m.holdObject.setPerspective(!0);break;case"brokenPlatform":m.holding=!0,m.holdObject=new ne(new M(e.offsetX,e.offsetY)),m.holdDetail=m.holdObject.detailFunction(),m.holdObject.setPerspective(!0);break;case"deathTotem":m.holding=!0,m.holdObject=new re(new M(e.offsetX,e.offsetY)),m.holdDetail=m.holdObject.detailFunction(),m.holdObject.setPerspective(!0)}"clear"!==j&&(m.clear=!1),i(m)}}},d=function(e){var a=new M(e.offsetX,e.offsetY);if(0===e.button&&t.select&&t.selecting&&a.between(s,n)){var o=Object(p.a)({},t);o.selecting=!1;var l=a.sub(s).toGrid(r);o.selectPair[1]=l,i(o)}else{var c=Object(p.a)({},t);c.select=!1,c.selecting=!1,i(c)}},y=function(e){e.preventDefault()};return e.addEventListener("mousemove",c),e.addEventListener("mousedown",h),e.addEventListener("mouseup",d),e.addEventListener("contextmenu",y),function(){e.removeEventListener("mousemove",c),e.removeEventListener("mousedown",h),e.removeEventListener("mouseup",d),e.removeEventListener("contextmenu",y)}}(a,h,y,r,u);return function e(){h.active&&zt(r.objects,r.map),Et(o,r,h),""!==h.message.text&&Date.now()>h.message.lastPost+3e3&&(h.message.text=""),t=requestAnimationFrame(e)}(),function(){e(),cancelAnimationFrame(t)}}),[y,h,r]);return Object(P.jsx)(P.Fragment,{children:Object(P.jsxs)("div",{children:[Object(P.jsx)("meta",{charset:"utf-8"}),Object(P.jsx)("canvas",{id:"EditModeCanvas",ref:i,width:"1200px",height:"582px",style:{textAlign:"center"}}),Object(P.jsx)("div",{style:{width:1024,height:64,backgroundColor:"inherit",margin:"0px auto"},children:Object(P.jsxs)("div",{id:"EditModeParameters",style:{backgroundColor:"inherit"},children:[h.select?Object(P.jsx)("div",{style:{textAlign:"center"},children:[["none","\u7a7a\u5730"],["block","\u5834\u5916"],["start","\u8d77\u9ede"],["end","\u7d42\u9ede"],["dead","\u6bd2\u9762"],["ice","\u51b0\u9762"],["muddy","\u6ce5\u9762"]].map((function(e){return Object(P.jsx)(f.a,{size:"small",color:"secondary",variant:"outlined",onClick:function(){!function(e){if(h.select){for(var t=M.leftUp(h.selectPair[0],h.selectPair[1]),i=M.rightDown(h.selectPair[0],h.selectPair[1]).sub(t).add(new M(1,1)),a=0;a<i.x;a++)for(var o=0;o<i.y;o++)if(r.map[t.y+o][t.x+a].layer.isOverlap(I.typeLayerPairs[e]))return;for(var s=[],n=0;n<i.x;n++)for(var l=0;l<i.y;l++)s.push(r.map[t.y+l][t.x+n].type),r.map[t.y+l][t.x+n].type=e;for(var c=!1,d=!1,p=0;p<I.mapSize.x;p++)for(var y=0;y<I.mapSize.y&&(!d||!c);y++)"start"===r.map[y][p].type?c=!0:"end"===r.map[y][p].type&&(d=!0);if(console.log(c),!d||!c){for(var u=0;u<i.x;u++)for(var b=0;b<i.y;b++)r.map[t.y+b][t.x+u].type=s.shift();h.message={text:"\u5730\u5716\u4e0a\u81f3\u5c11\u5fc5\u9808\u5305\u542b\u4e00\u683c\u8d77\u9ede\u548c\u4e00\u683c\u7d42\u9ede",lastPost:Date.now()}}}}(e[0])},disabled:!h.select,children:e[1]})}))}):Object(P.jsx)("div",{}),h.holding||h.hold?Object(P.jsx)("div",{style:{backgroundColor:"inherit",marginRight:"0.1cm"},children:Object.keys(h.holdDetail).map((function(e){switch(h.holdDetail[e].type){case"text":return Object(P.jsx)("div",{style:{display:"inline-block",float:"left",backgroundColor:"inherit",marginRight:"0.5cm"},children:Object(P.jsx)(v.a,{label:Xt[e]?Xt[e]:e,value:h.holdObject.detail[e],onChange:function(t){var i=Object(p.a)({},h),a=Object(p.a)({},h.holdObject.detail);a[e]=t.target.value,i.holdObject.detail=a,y(i)}})});case"select":return Object(P.jsx)("div",{style:{display:"inline-block",float:"left",backgroundColor:"inherit",marginRight:"0.5cm"},children:Object(P.jsxs)(Wt.a,{variant:"outlined",className:o.formControl,children:[Object(P.jsx)(qt.a,{children:Xt[e]?Xt[e]:e}),Object(P.jsx)(Nt.a,{value:h.holdObject.detail[e],onChange:function(t){var i=Object(p.a)({},h),a=Object(p.a)({},h.holdObject.detail);a[e]=t.target.value,i.holdObject.detail=a,y(i)},label:Xt[e]?Xt[e]:e,children:h.holdDetail[e].options.map((function(e){return Object(P.jsx)(Gt.a,{value:e,children:Xt[e]?Xt[e]:e})}))})]})});case"int":return Object(P.jsxs)("div",{style:{display:"inline-block",float:"left",backgroundColor:"inherit",marginRight:"0.5cm"},children:[Object(P.jsx)(xe.a,{id:"discrete-slider",gutterBottom:!0,children:Xt[e]?Xt[e]:e}),Object(P.jsx)(Yt.a,{style:{minWidth:200},value:h.holdObject.detail[e],"aria-labelledby":"discrete-slider",valueLabelDisplay:"auto",step:1,marks:!0,min:h.holdDetail[e].min,max:h.holdDetail[e].max,onChange:function(t,i){var a=Object(p.a)({},h),o=Object(p.a)({},h.holdObject.detail);o[e]=i,a.holdObject.detail=o,y(a)}})]});case"check":return Object(P.jsx)("div",{style:{display:"inline-block",float:"left",backgroundColor:"inherit",marginRight:"0.5cm"},children:Object(P.jsx)(k.a,{control:Object(P.jsx)(Bt.a,{checked:h.holdObject.detail[e],onChange:function(t){var i=Object(p.a)({},h),a=Object(p.a)({},h.holdObject.detail);a[e]=t.target.checked,i.holdObject.detail=a,y(i)}}),label:Xt[e]?Xt[e]:e})});default:return Object(P.jsx)("div",{})}}))}):Object(P.jsx)("div",{style:{backgroundColor:"inherit"}})]})})]})})})),Ht=i(94),Vt=i.n(Ht),Kt=i(91),Qt=i.n(Kt);function Jt(e){return Object(P.jsx)(w.a,Object(p.a)({elevation:6,variant:"filled"},e))}var Zt=Object(g.a)((function(e){return{margin:{margin:e.spacing(1)},extendedIcon:{marginRight:e.spacing(1)}}}));function $t(e){return void 0!==e.location.state&&!!e.location.state.login}function ei(e){var t=Zt(),i=Object(y.f)(),o=Object(a.useState)(!1),s=Object(d.a)(o,2),n=s[0],r=s[1],l=Object(a.useState)(e.data.title),p=Object(d.a)(l,2),u=p[0],f=p[1],g=Object(a.useState)(e.data.description),w=Object(d.a)(g,2),O=w[0],S=w[1],T=Object(a.useState)(!1),F=Object(d.a)(T,2),C=F[0],D=F[1],M=Object(a.useState)(""),A=Object(d.a)(M,2),R=A[0],I=A[1],L=Object(a.useState)("success"),E=Object(d.a)(L,2),z=E[0],B=E[1],G=Object(a.useState)(Be),N=Object(d.a)(G,2),W=N[0],q=N[1],Y=Object(a.useState)(!1),X=Object(d.a)(Y,2),_=X[0],U=X[1],H=Object(a.useState)(!1),V=Object(d.a)(H,2),K=V[0],Q=V[1],J=Object(a.useState)(!1),Z=Object(d.a)(J,2),$=Z[0],ee=Z[1],te=Object(a.useState)(e.data.id),ie=Object(d.a)(te,2),ae=ie[0],oe=ie[1],se=Object(a.useRef)(),ne=e.data,re=ne.name,de=ne.uuid,pe=(ne.login,function(){var e=Object(h.a)(c.a.mark((function e(){var t,i,a,o,s,n,l;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("upload function"),t=W,i=ae,e.next=5,b.post("/api/upload",{uuid:de,settingPack:t,title:u,description:O,name:re,publish:K,id0:i});case 5:a=e.sent,o=a.data,s=o.success,n=o.errorCode,l=o.idNew,s?(I("This is a success message!"),B("success"),D(!0)):1===n?(I("This map exists. The map has been updated"),B("info"),D(!0)):2===n?(I("Too many maps!! Every user can only save 8 maps."),B("error"),D(!0)):(I("Unknow error. Error code:".concat(n)),B("error"),D(!0)),oe(l),console.log("Upload success"),r(!1);case 14:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}());0!==ae&&!1===_&&function(){var e=Object(h.a)(c.a.mark((function e(){var t,i,a,o,s;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.post("/api/getMap",{id:ae});case 2:t=e.sent,i=t.data,a=i.success,o=i.errorCode,s=i.map,a?(I("Load data success"),B("success"),D(!0),q(s.content),U(!0)):(I("Error. Error code:".concat(o)),B("error"),D(!0));case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()(),$&&(pe(),ee(!1));return Object(P.jsxs)("div",{style:{textAlign:"center"},children:[Object(P.jsx)(x.a,{open:C,autoHideDuration:500,onClose:function(){D(!1)},children:Object(P.jsx)(Jt,{onClose:function(){D(!1)},severity:z,children:R})}),Object(P.jsxs)("div",{style:{marginTop:"1em"},children:[Object(P.jsx)(Te.a,{className:t.margin,size:"large",variant:"outlined",color:"secondary",onClick:i.goBack,children:Object(P.jsx)(gt.a,{})}),Object(P.jsx)(Te.a,{className:t.margin,size:"large",variant:"outlined",color:"secondary",disabled:0===Object.entries(W).length,onClick:function(){se.current.returnSetting(),r(!0)},children:Object(P.jsx)(Vt.a,{})}),Object(P.jsx)(Te.a,{size:"large",variant:"contained",color:"secondary",onClick:function(){se.current&&se.current.returnSetting(),u&&O?(Q(!1),ee(!0)):r(!0)},children:Object(P.jsx)(Qt.a,{})})]}),Object(P.jsx)(m.a,{open:n,onClose:function(){r(!1)},children:Object(P.jsxs)(P.Fragment,{children:[Object(P.jsxs)("div",{className:"upload",children:[Object(P.jsx)(v.a,{label:"Title",variant:"filled",rows:1,placeholder:"Title",defaultValue:"",value:u,onChange:function(e){f(e.target.value)}}),Object(P.jsx)(v.a,{id:"filled-textarea",label:"Description",variant:"filled",multiline:!0,placeholder:"Description",defaultValue:"",value:O,onChange:function(e){S(e.target.value)}}),Object(P.jsx)(Te.a,{className:t.margin,size:"large",variant:"contained",color:"secondary",onClick:pe,disabled:!u||!O,children:Object(P.jsx)(Vt.a,{})})]}),Object(P.jsx)("div",{className:"upload_",children:Object(P.jsx)(k.a,{control:Object(P.jsx)(j.a,{checked:K,onChange:function(){return Q(!K)},name:"public on internet"}),label:"public on internet"})})]})}),!0===C?Object(P.jsx)(he,{}):Object(P.jsx)(Ut,{width:"1200px",height:"600px",ref:se,setting:ce(W),save:function(e){console.log("Update setting"),q(le(e))}})]})}var ti=function(e){return Object(P.jsx)(P.Fragment,{children:$t(e)?Object(P.jsx)(ei,{data:e.location.state}):Object(P.jsx)(Ye,{})})},ii="1250",ai="680",oi={x:-270,y:-110},si={w:2.5,h:2.5},ni=10,ri="GAME OVER",li="WIN",ci={spike:"\u88ab\u523a\u5230\u4e86",arrow:"\u51b7\u7bad\u96e3\u9632QQ",cymbalWave:"\u97f3\u6ce2\uff01",missile:"\u4f86\u81ea\u5317\u7def39\xb0\u7684\u98db\u5f48",deathTotem:"\u6b7b\u4ea1\u5716\u9a30\uff01\uff01",dead:"\u7d2b\u8272\u6709\u6bd2 ~ ",end:"\u9003\u51fa\u4f86\u60f9"},hi="https://github.com/allpass122/WebProgrammmingFinal2020",di=i.p+"static/media/seal.e6aeaa60.svg",pi=i.p+"static/media/lion.a9dff392.svg",yi=i.p+"static/media/cat.a83e8f86.svg",ui=i.p+"static/media/star.d1d61ef5.svg",bi=["seal.svg","lion.svg","cat.svg"],fi={"seal.svg":di,"lion.svg":pi,"cat.svg":yi,"star.svg":ui},vi={},gi=Promise.all(["seal.svg","lion.svg","cat.svg","star.svg"].map((function(e){return new Promise((function(t){var i=new Image;i.onload=function(){vi[e]=i,t()},i.src=fi[e]}))})));var mi=function(e){return vi[e]};function ki(e,t,i){if(i.FOCUS_PLAYER){var a=I.gridWidth,o=0*I.mapStart.x+I.mapSize.x*a/2-t.x,s=0*I.mapStart.y+I.mapSize.y*a/2-t.y;e.translate(o,s)}}function ji(e,t,i){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"seal.svg",o=t.x,s=t.y;I.gridWidth;e.save(),e.translate(o,s),e.drawImage(mi(a),-ni,-ni,2*ni,2*ni),e.restore()}var xi=function(e,t,i){var a=t.map,o=t.objects,s=i.me.serializeForUpdate(),n=I.gridWidth;Ae(e),e.fillStyle=I.blockColor,e.fillRect(0,0,I.mapSize.x*n*2,I.mapSize.y*n*2),e.restore(),e.save(),i.FOCUS_PLAYER?(e.scale(si.w,si.h),e.translate(oi.x,oi.y)):(e.scale(1.2,1.2),e.translate(-80,30)),e.save(),e.translate(I.mapStart.x,I.mapStart.y),ki(e,s,i),Re(e,a,true),e.restore(),e.save(),ki(e,s,i);for(var r=0;r<I.maxLayer;r++){3===r&&ji(e,s,s,i.head);for(var l=0;l<o.length;l++)o[l].layer.top()===r&&o[l].draw(e)}e.restore()};var wi=I.gridWidth,Pi=[];function Oi(e,t,i){var a=t.map,o=Date.now()-e.lastUpdateTime;!function(e,t,i){var a=e.me.serializeForUpdate(),o=a.x,s=a.y,n=(e.me.me,I.mapStart.x+ni),r=I.mapStart.x+I.mapSize.x*wi-ni,l=I.mapStart.y+ni,c=I.mapStart.y+I.mapSize.y*wi-ni;(o<n||o>r||s<l||s>c)&&(e.me.returnLastLoc(),o<n?e.me.rebound(new M(n-wi,s)):o>r?e.me.rebound(new M(r+wi,s)):s<l?e.me.rebound(new M(o,l-wi)):s>c&&e.me.rebound(new M(o,999)));Pi.some((function(t){if(o+ni>I.mapStart.x+t.x*wi&&o-ni<I.mapStart.x+(t.x+1)*wi&&s+ni>I.mapStart.y+t.y*wi&&s-ni<I.mapStart.y+(t.y+1)*wi)return e.me.returnLastLoc(),e.me.squareRebound(new M(I.mapStart.x+(t.x+.5)*wi,I.mapStart.y+(t.y+.5)*wi)),!0}));var h=Math.floor((o-I.mapStart.x)/wi),d=Math.floor((s-I.mapStart.y)/wi);if(h<0||h>I.mapSize.x||d<0||d>I.mapSize.y)return;var y=t[d][h].type;e.me.resetFriction(),e.me.onPlatform()?e.me.setFriction(6):y.includes("none")||y.includes("start")||y.includes("end")?e.me.setFriction(1):y.includes("muddy")?e.me.setFriction(5):y.includes("ice")?e.me.setFriction(.5):y.includes("dead")&&i((function(){return Object(p.a)(Object(p.a)({},e),{},{gameState:ri,msg:"".concat(ci.dead),endTime:Date.now(),playTime:Date.now()-e.startTime})}));y.includes("end")&&i((function(){return Object(p.a)(Object(p.a)({},e),{},{gameState:li,msg:"".concat(ci.end),endTime:Date.now(),playTime:Date.now()-e.startTime})}));e.me.updateLastLoc()}(e,a,i),function(e,t,i){for(var a,o,s=t.objects,n=t.map,r=e.me,l=!1,c=Math.MAX_SAFE_INTEGER,h=!1,d=0,y=0;y<s.length;y++){if(s[y].collision)if("continue"===function(){var t=s[y].collision({type:"sphere",pos:r.loc,r:ni});if(t.includes("none"))return"continue";r.resetFriction(),console.log("result",t),"block"!==t&&"lockedWall"!==t&&"cymbal"!==t&&"missileBase"!==t&&"woodenBox"!==t||h?"platform"===t||"movingPlatform"===t||"brokenPlatform"===t||r.loc.length(s[y].pos)<c?("brokenPlatform"===t&&s[y].break(),l=!0,c=r.loc.length(s[y].pos),a=y,o=s[y].pos,e.me.setFriction(3)):"unlocker"===t?s[y].unlock(s):"portal"===t?r.moveTo(s[y].teleport(s)):"conveyor"===t&&d<.99?(r.addVelocity(s[y].detail.direction,12),d++):"missileRay"===t?s[y].fire(r):"trap"===t?r.setLastFriction():"magneticField"===t?r.loc=r.loc.add(s[y].getDisplacement()):"spike"!==t&&"arrow"!==t&&"cymbalWave"!==t&&"missile"!==t&&"deathTotem"!==t||i((function(){return Object(p.a)(Object(p.a)({},e),{},{gameState:ri,msg:"".concat(ci[t]),endTime:Date.now(),playTime:Date.now()-e.startTime})})):("woodenBox"===t&&s[y].push(s,n,r.pos),h=!0,r.returnLastLoc(),r.squareRebound(s[y].pos)),"mucus"===t?e.me.setFriction(10):"ice"===t&&e.me.setFriction(.4)}())continue}l&&!h?r.moveOnPlatform(a,o):r.leavePlatform()}(e,t,i),e.lastUpdateTime=Date.now(),function(e){var t=e.pressDown,i=e.pressRight,a=e.pressLeft,o=e.pressUp,s=0,n=0;t&&(n+=1);o&&(n-=1);i&&(s+=1);a&&(s-=1);e.me.push(new M(s,n))}(e),e.me.update(o)}var Si=function(){function e(t,i,a,o){Object(C.a)(this,e),this.id=t,this.loc=new M(a,o),this.velocity=new M(0,0),this.username=i,this.score=0,this.pos=new M(0,0),this.friction=.08,this.lastFriction=0,this.m=1,this.force=new M(0,0),this.acceleration=new M(0,0),this.lastLoc=new M(a,o),this.lastPlatformID="-1",this.lastPlatformPos=new M(0,0)}return Object(D.a)(e,[{key:"update",value:function(e){return e/=1e3,this.updateFAV(e),this.pos=this.loc,null}},{key:"updateFAV",value:function(e){var t=this.velocity.unit().mul(Math.pow(this.velocity.length(),2));this.acceleration=this.force.sub(t.mul(this.friction)).div(this.m),this.velocity=this.velocity.add(this.acceleration.mul(e)),this.checkVelocity(),this.loc=this.loc.add(this.velocity.mul(e)),this.force=new M(0,0)}},{key:"checkVelocity",value:function(){this.velocity.length()>160&&(this.velocity=this.velocity.unit().mul(160))}},{key:"moveTo",value:function(e,t){if(t)this.loc=new M(e,t);else{var i=e;this.loc=i}}},{key:"addVelocity",value:function(e,t){switch(e){case"down":this.velocity=this.velocity.add(new M(0,t));break;case"right":this.velocity=this.velocity.add(new M(t,0));break;case"left":this.velocity=this.velocity.add(new M(-t,0));break;case"up":this.velocity=this.velocity.add(new M(0,-t))}}},{key:"moveOnPlatform",value:function(e,t){e=e.toString(),"-1"!==this.lastPlatformID&&this.lastPlatformID===e||(this.lastPlatformID=e,this.lastPlatformPos=t),this.lastPlatformID===e&&(this.loc=this.loc.add(t.sub(this.lastPlatformPos)),this.lastPlatformPos=t)}},{key:"leavePlatform",value:function(){this.lastPlatformID="-1"}},{key:"onPlatform",value:function(){return"-1"!==this.lastPlatformID}},{key:"squareRebound",value:function(e){var t=new M(this.loc.x-e.x,this.loc.y-e.y),i=Math.atan2(t.y,t.x);-3/4*Math.PI<i&&i<-1/4*Math.PI?this.rebound(new M(this.loc.x,999)):-1/4*Math.PI<i&&i<1/4*Math.PI?this.rebound(new M(0,this.loc.y)):1/4*Math.PI<i&&i<3/4*Math.PI?this.rebound(new M(this.loc.x,0)):3/4*Math.PI<i||-3/4*Math.PI>i&&i<0?this.rebound(new M(999,this.loc.y)):console.log("why? no bound")}},{key:"rebound",value:function(e){var t=new M(this.loc.x-e.x,this.loc.y-e.y),i=Math.atan2(t.y,t.x)+.5*Math.PI,a=t.mul(-1).unit(),o=Math.cos(2*i)*a.x+Math.sin(2*i)*a.y,s=Math.sin(2*i)*a.x-Math.cos(2*i)*a.y;this.velocity=new M(o,s).mul(50),this.checkVelocity()}},{key:"returnLastLoc",value:function(e){this.loc=this.lastLoc}},{key:"setFriction",value:function(e){this.lastFriction=this.friction,this.friction=this.friction*e}},{key:"setLastFriction",value:function(){this.friction=this.lastFriction}},{key:"resetFriction",value:function(){this.lastFriction=this.friction,this.friction=.08}},{key:"updateLastLoc",value:function(){this.lastLoc=this.loc}},{key:"push",value:function(e){this.force=e.mul(800)}},{key:"serializeForUpdate",value:function(){return{id:this.id,loc:this.loc,x:this.loc.x,y:this.loc.y,velocity:this.velocity}}}]),e}(),Ti=(i(194),function(e){var t=Object(a.useState)(e.setting),i=Object(d.a)(t,2),o=i[0],s=i[1],n=Object(a.useState)(!1),r=Object(d.a)(n,2),l=r[0],y=r[1];Object(a.useEffect)(Object(h.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:gi.then(y(!0));case 1:case"end":return e.stop()}}),e)}))));var u=Object(a.useRef)(),b={me:new Si(1,"name",0,0),startTime:Date.now(),endTime:Date.now(),playTime:0,gameState:"start",head:"seal.svg",msg:"Happy",FOCUS_PLAYER:!1,pressDown:!1,pressRight:!1,pressLeft:!1,pressUp:!1},f=Object(a.useState)(b),v=Object(d.a)(f,2),g=v[0],m=v[1];function k(e){document.getElementById(e).style.display="none",m((function(){return Object(p.a)(Object(p.a)({},b),{},{head:g.head,gameState:"playing",FOCUS_PLAYER:!0})}))}function j(e){document.getElementById(e).style.display="block"}Object(a.useEffect)((function(){g.gameState!==ri&&g.gameState!==li||(e.challenge(g.endTime-g.startTime,g.gameState===li),j("gameForm"),s((function(){return ce(le(o))})))}),[g]),Object(a.useEffect)((function(){if(l){var e,t,i,a,s,n,r=u.current,c=r.getContext("2d");return e=function(e,t,i,a){var o={37:"left",38:"up",39:"right",40:"down"};function s(e){switch(o[e.keyCode]){case"down":t.pressDown=!0;break;case"right":t.pressRight=!0;break;case"left":t.pressLeft=!0;break;case"up":t.pressUp=!0}}function n(e){switch(o[e.keyCode]){case"down":t.pressDown=!1;break;case"right":t.pressRight=!1;break;case"left":t.pressLeft=!1;break;case"up":t.pressUp=!1}}return window.addEventListener("keydown",s),window.addEventListener("keyup",n),function(){window.removeEventListener("keydown",s),window.removeEventListener("keyup",n)}}(0,g),function(e,t){var i=t.map,a=t.objects,o=[];i.forEach((function(e,t){return e.forEach((function(e,i){e.type.includes("start")&&o.push({x:i,y:t})}))}));var s=o[Math.floor(Math.random()*o.length)],n=s.x,r=s.y;e.me.moveTo(I.mapStart.x+(n+.5)*wi,I.mapStart.y+(r+.5)*wi),Pi=[],i.forEach((function(e,t){return e.forEach((function(e,i){e.type.includes("block")&&Pi.push({x:i,y:t})}))}));for(var l=0;l<a.length;l++)a[l].setPerspective&&a[l].setPerspective(!1);e.startTime=Date.now(),e.lastUpdateTime=Date.now()}(g,o),i=1e3/30,s=Date.now(),s,h(),g.gameState!==ri&&"start"!==g.gameState||e(),"start"===g.gameState&&j("startForm"),"start"!==g.gameState&&"playing"!==g.gameState&&cancelAnimationFrame(t),function(){e(),cancelAnimationFrame(t)}}function h(){t=requestAnimationFrame(h),Oi(g,o,m),a=Date.now(),(n=a-s)>i&&(s=a-n%i,zt(o.objects,o.map),xi(c,o,g))}}),[m,g,o,l]);var x,w=Object(P.jsx)("div",{children:Object(P.jsxs)("button",{className:"githubButton",onClick:function(){window.open(hi,"_blank")},children:[Object(P.jsx)("img",{src:mi("star.svg").src})," Star"]})});return Object(P.jsxs)(P.Fragment,{children:[Object(P.jsx)("div",{children:Object(P.jsx)("canvas",{ref:u,id:"PlayModeCanvas",width:ii,height:ai})}),Object(P.jsxs)("div",{className:"form-popup",id:"gameForm",children:[Object(P.jsx)("span",{children:g.gameState}),Object(P.jsx)("p",{children:g.msg}),Object(P.jsx)("span",{children:(x=g.playTime,"".concat(Math.floor(x/1e3/60).toString().padStart(2,"0")," : ").concat(Math.floor(x/1e3%60).toString().padStart(2,"0")))}),Object(P.jsx)("button",{className:"gameButton",onClick:function(){k("gameForm")},children:"Try Again"}),w]}),Object(P.jsxs)("div",{className:"form-popup",id:"startForm",children:[Object(P.jsx)("span",{children:"Choose A Player"}),Object(P.jsx)("div",{onChange:function(e){g.head=e.target.value},children:l?bi.map((function(e){return Object(P.jsxs)("label",{children:[Object(P.jsx)("input",{type:"radio",name:"test",value:e}),Object(P.jsx)("img",{src:mi(e).src})]})})):Object(P.jsx)(P.Fragment,{})}),Object(P.jsx)("button",{className:"gameButton",onClick:function(){k("startForm")},children:"START"}),w]})]})}),Fi=i(129),Ci=i.n(Fi),Di=i(128),Mi=i.n(Di);function Ai(e){return Object(P.jsx)(w.a,Object(p.a)({elevation:6,variant:"filled"},e))}function Ri(e){return void 0!==e.location.state&&!!e.location.state.login}var Ii=Object(g.a)((function(e){return{margin:{margin:e.spacing(1)},extendedIcon:{marginRight:e.spacing(1)}}})),Li=function(e){var t=Object(y.f)(),i=Ii(),o=Object(a.useState)(!1),s=Object(d.a)(o,2),n=(s[0],s[1],Object(a.useState)(!1)),r=Object(d.a)(n,2),l=r[0],u=r[1],f=Object(a.useState)(""),v=Object(d.a)(f,2),g=v[0],m=v[1],k=Object(a.useState)("success"),j=Object(d.a)(k,2),w=j[0],O=j[1],S=Object(a.useState)(!1),T=Object(d.a)(S,2),F=(T[0],T[1]),C=Object(a.useState)(""),D=Object(d.a)(C,2),M=D[0],A=D[1],R=Object(a.useState)({}),I=Object(d.a)(R,2),L=I[0],E=I[1],z=Object(a.useState)(!0),B=Object(d.a)(z,2),G=(B[0],B[1]),N=e.data,W=N.name,q=(N.uuid,N.login,N.id),Y=N.mode,X=function(){var e=Object(h.a)(c.a.mark((function e(){var t,i,a,o,s;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.post("/api/getMap",{id:q});case 2:t=e.sent,i=t.data,a=i.success,o=i.errorCode,s=i.map,a?(m("Load data success"),O("success"),u(!0),A(s.content),E(s),F(!0)):(m("Error. Error code:".concat(o)),O("error"),u(!0));case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),_=function(){var e=Object(h.a)(c.a.mark((function e(t){var i,a,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.post("/api/challengeSuccess",{mapLocal:t});case 2:i=e.sent,a=i.data,o=a.success,a.errorCode,console.log("challenge: ".concat(o));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(a.useEffect)((function(){G(!0),X()}),[]),Object(P.jsxs)("div",{style:{textAlign:"center"},children:[Object(P.jsx)(x.a,{open:l,autoHideDuration:500,onClose:function(){u(!1)},children:Object(P.jsx)(Ai,{onClose:function(){u(!1)},severity:w,children:g})}),Object(P.jsxs)("div",{style:{marginTop:"1em"},children:[Object(P.jsx)(Te.a,{className:i.margin,size:"large",variant:"outlined",color:"secondary",onClick:t.goBack,children:Object(P.jsx)(gt.a,{})}),Object(P.jsxs)(Te.a,{className:i.margin,size:"large",variant:"outlined",color:"secondary",children:["challenge"===Y?Object(P.jsx)(Mi.a,{}):Object(P.jsx)(Ci.a,{}),"challenge"===Y?"Challenge Mode":" Practice Mode"]})]}),""===M||!0===l?Object(P.jsx)(he,{}):Object(P.jsx)(Ti,{width:"1200px",height:"600px",setting:ce(M),challenge:function(e,t){if("challenge"===Y){console.log("receive challenge ".concat(e));var i=Object(p.a)({},L);i.statistic.playTime+=1,t&&(i.statistic.passTime+=1,i.passPeople.includes(W)||i.passPeople.push(W)),i.statistic.fastestPass>e/1e3&&t&&(i.statistic.fastestPass=e/1e3,i.statistic.fastestMan=W),_(i)}else console.log("practice no record")}})]})};var Ei=function(e){return Object(P.jsx)(P.Fragment,{children:Ri(e)?Object(P.jsx)(Li,{data:e.location.state}):Object(P.jsx)(Ye,{})})};n.a.render(Object(P.jsx)(o.a.StrictMode,{children:Object(P.jsx)(F.a,{basename:"/WebProgrammmingFinal2020",children:Object(P.jsxs)(y.c,{children:[Object(P.jsx)(y.a,{exact:!0,path:"/",component:T}),Object(P.jsx)(y.a,{exact:!0,path:"/users/selectPage",component:_e}),Object(P.jsx)(y.a,{exact:!0,path:"/PopularMap",component:Lt}),Object(P.jsx)(y.a,{exact:!0,path:"/EditMode",component:ti}),Object(P.jsx)(y.a,{exact:!0,path:"/PlayMode",component:Ei})]})})}),document.getElementById("root")),r()}},[[195,1,2]]]);
//# sourceMappingURL=main.5c23e18a.chunk.js.map